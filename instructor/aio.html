<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to HPC: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to HPC
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to HPC
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to HPC
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="10-hpc-intro.html">1. Why use an HPC System?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="20-cluster.html">2. Working on an HPC system</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="30-scheduler.html">3. Working with the scheduler</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="40-modules.html">4. Accessing software via Modules</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="50-transferring-files.html">5. Transferring files with remote computers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="60-parallel-job.html">6. Running a parallel job</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="70-resources.html">7. Using resources effectively</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="80-responsibility.html">8. Using shared resources responsibly</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-10-hpc-intro"><p>Content from <a href="10-hpc-intro.html">Why use an HPC System?</a></p>
<hr>
<p>Last updated on 2025-03-05 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/10-hpc-intro.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is an HPC system?</li>
<li>How does an HPC system work?</li>
<li>Why would I be interested in High Performance Computing (HPC)?</li>
<li>What can I expect to learn from this course?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Be able to describe what an HPC system is</li>
<li>Identify how an HPC system could benefit you.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-an-hpc-system">What Is an HPC System?<a class="anchor" aria-label="anchor" href="#what-is-an-hpc-system"></a>
</h2>
<hr class="half-width">
<p>The words “cloud”, “cluster”, and the phrase “high-performance
computing” or “HPC” are used a lot in different contexts and with
various related meanings. So what do they mean? And more importantly,
how do we use them in our work?</p>
</section><section><h2 class="section-heading" id="jargon-busting">Jargon Busting<a class="anchor" aria-label="anchor" href="#jargon-busting"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="your-personal-computer">Your Personal Computer<a class="anchor" aria-label="anchor" href="#your-personal-computer"></a>
</h3>
<p>We are probably all familiar with a laptop or a desktop computer
(some call it a PC for Personal Computer). These computers are aimed at
individual users and people coding or analysing. Typically each one of
us, in the classroom, has our own laptop or a university computer in
front of us and we can work independantly of one another. It is good for
performaing local and personal tasks but it has limited resources.</p>
<figure><img src="../fig/200px-laptop-openclipartorg-aoguerrero.svg" alt="A standard laptop" class="figure mx-auto d-block"><div class="figcaption">A standard laptop</div>
</figure>
</div>
<div class="section level3">
<h3 id="shared-computing-resources">Shared Computing Resources<a class="anchor" aria-label="anchor" href="#shared-computing-resources"></a>
</h3>
<p>What happens when we want to share resources, like printers or files?
In the late 1950s the US military built a network of computers that used
modems and normal telephone lines connect to one another. Things have
progressed quite a bit since then. Today our computers can talk to one
another in several ways. At most universities you might notice that the
desktop computers have a wire (called an Ethernet cable) that connects
it to the university’s network. Laptops and other devices such as phones
and tablets can also connect to networks using WiFi which is a wireless
technology using radio waves. However what happens if we want a computer
to perform a task which requires much more hardware than what our
desktop or laptop can provide us with?</p>
</div>
<div class="section level3">
<h3 id="a-larger-computer">A Larger Computer<a class="anchor" aria-label="anchor" href="#a-larger-computer"></a>
</h3>
<p>One alternative is to build up a computer with very powerful
components. The main components of a computer would be its input
devices, processor, memory and output devices such a hard drive. Each of
these components can be upgraded to more powerful versions. This is
somewhat analogous to buying a car. You might decide to buy a car that
can take more people so instead of a two seater sports car you would
look at a bigger car that can take four, six or eight people. However, a
car that can carry eight people will also need a bigger engine because
the engine of the smaller car won’t be strong enough to move eight
people. Computers can also be specced to accomplish certain tasks, so
for some tasks you might need very fast processing power but not so much
memory, other jobs might need lots of memory while others might need
really big hard drives to store data too.</p>
<p>A big disadvantage of a computer with bigger and better hardware is
that its application becomes limited or in some cases using it for other
tasks might mean that its use becomes very expensive or it might just
not be as suitable anymore. Using the car analogy; you wouldn’t use a
bus to take your two children to school on a regular basis. So you might
find that quite often a very expensive computer was purchased for a
specific project and after completion of the project the computer
becomes an extremely expensive ornament standing in a corner gather
dust. What is the alternative?</p>
</div>
<div class="section level3">
<h3 id="cloud-systems">Cloud Systems<a class="anchor" aria-label="anchor" href="#cloud-systems"></a>
</h3>
<p>How about buying a car suitable to take your children to school on a
regular basis and then <strong>renting</strong> a bus for the odd
occasion that you have to take 30 kids to the museum? We now have cloud
computing available to be able to fulfil a similar role when the need
arises to use a bigger or faster computer. But first, what exactly is
cloud computing? Actually it is nothing other than computer networks, as
described in the section about <strong>Shared Computing
Resources</strong>, that belong to external organisations and are
connected to the Internet so that, in turn, we can also connect to them.
And for the privilege of being able to access those computers we will
pay a fee - like renting a car. We can specify exactly what we need in
terms of the amount of memory, the speed of the processors, the amount
of RAM and so forth. So this might be a good solution but, as always,
there are loads of ifs and buts … so what if we, as an organisation,
make so much use of these computers that we want our very own? Cloud
computers will also have certain limitations so that we can’t always get
the specifications we want so we might, even if we can’t afford our own,
want an alternative to cloud computing.</p>
<p>The Cloud is a generic term commonly used to refer to computing
resources that are a) provisioned to users on demand or as needed and b)
represent real or virtual resources that may be located anywhere on
Earth. For example, a large company with computing resources in Brazil,
Zimbabwe and Japan may manage those resources as its own internal cloud
and that same company may also utilize commercial cloud resources
provided by Amazon or Google. Cloud resources may refer to machines
performing relatively simple tasks such as serving websites, providing
shared storage, providing web services (such as e-mail or social media
platforms), as well as more traditional compute intensive tasks such as
running a simulation.</p>
</div>
<div class="section level3">
<h3 id="a-cluster-or-supercomputer">A Cluster or Supercomputer<a class="anchor" aria-label="anchor" href="#a-cluster-or-supercomputer"></a>
</h3>
<p>The term HPC system, on the other hand, describes a stand-alone
resource for computationally intensive workloads. They are typically
comprised of a multitude of integrated processing and storage elements,
designed to handle high volumes of data and/or large numbers of
floating-point operations (FLOPS) with the highest possible performance.
For example, all of the machines on the Top-500 list are HPC systems. To
support these constraints, an HPC resource must exist in a specific,
fixed location: networking cables can only stretch so far, and
electrical and optical signals can travel only so fast.</p>
<p>The word “cluster” is often used for small to moderate scale HPC
resources less impressive than the Top-500. Clusters are often
maintained in computing centers that support several such systems, all
sharing common networking and storage to support common compute
intensive tasks.</p>
<p>Let’s dissect what resources programs running on a laptop
require:</p>
<ul>
<li>the keyboard and/or touchpad is used to tell the computer what to do
(<strong>Input</strong>)</li>
<li>the internal computing resources <strong>Central Processing
Unit</strong> and <strong>Memory</strong> perform calculation</li>
<li>the display depicts progress and results
(<strong>Output</strong>)</li>
</ul>
<p>Schematically, this can be reduced to the following:</p>
<figure><img src="../fig/Simple_Von_Neumann_Architecture.svg" alt="Schematic of how a computer works" class="figure mx-auto d-block"><div class="figcaption">Schematic of how a computer works</div>
</figure>
</div>
</section><section><h2 class="section-heading" id="when-tasks-take-too-long">When Tasks Take Too Long<a class="anchor" aria-label="anchor" href="#when-tasks-take-too-long"></a>
</h2>
<hr class="half-width">
<p>When the task to solve becomes heavy on computations, the operations
are typically out-sourced from the local laptop or desktop to elsewhere.
Take for example the task to find the directions for your next vacation.
The capabilities of your laptop are typically not enough to calculate
that route spontaneously: <a href="https://en.wikipedia.org/wiki/Dijkstra's_algorithm" class="external-link">finding
the shortest path</a> through a network runs on the order of (<em>v</em>
log <em>v</em>) time, where <em>v</em> (vertices) represents the number
of intersections in your map. Instead of doing this yourself, you use a
website, which in turn runs on a server, that is almost definitely not
in the same room as you are.</p>
<figure><img src="../fig/servers-openclipartorg-ericlemerdy.svg" style="width:33.0%" alt="A rack half full with servers" class="figure mx-auto d-block"><div class="figcaption">A rack half full with servers</div>
</figure><p>Note here, that a server is mostly a noisy computer mounted into a
rack cabinet which in turn resides in a data center. The Internet made
it possible that these data centers do not require to be nearby your
laptop. What people call <strong>The Cloud</strong> is mostly a
web-service where you can rent such servers by providing your credit
card details and requesting remote resources that satisfy your
requirements. This is often handled through an online, browser-based
interface listing the various machines available and their capacities in
terms of processing power, memory, and storage.</p>
<p>The server itself has no direct display or input methods attached to
it. But most importantly, it has much more storage, memory and compute
capacity than your laptop will ever have. In any case, you need a local
device (laptop, workstation, mobile phone or tablet) to interact with
this remote machine, which people typically call ‘a server’.</p>
</section><section><h2 class="section-heading" id="when-one-server-is-not-enough">When One Server Is Not Enough<a class="anchor" aria-label="anchor" href="#when-one-server-is-not-enough"></a>
</h2>
<hr class="half-width">
<p>If the computational task or analysis to complete is daunting for a
single server, larger agglomerations of servers are used. These go by
the name of “clusters” or “super computers”.</p>
<figure><img src="../fig/serverrack-openclipartorg-psteinb-basedon-ericlemerdy.svg" style="width:33.0%" alt="A rack with servers" class="figure mx-auto d-block"><div class="figcaption">A rack with servers</div>
</figure><p>The methodology of providing the input data, configuring the program
options, and retrieving the results is quite different to using a plain
laptop. Moreover, using a graphical interface is often discarded in
favor of using the command line. This imposes a double paradigm shift
for prospective users asked to</p>
<ol style="list-style-type: decimal">
<li>work with the command line interface (CLI), rather than a graphical
user interface (GUI)</li>
<li>work with a distributed set of computers (called nodes) rather than
the machine attached to their keyboard &amp; mouse</li>
</ol>
<div id="ive-never-used-a-server-have-i" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="ive-never-used-a-server-have-i" class="callout-inner">
<h3 class="callout-title">I’ve Never Used a Server, Have I?</h3>
<div class="callout-content">
<p>Take a minute and think about which of your daily interactions with a
computer may require a remote server or even cluster to provide you with
results.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Some Ideas
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul>
<li>Checking email: your computer (possibly in your pocket) contacts a
remote machine, authenticates, and downloads a list of new messages; it
also uploads changes to message status, such as whether you read, marked
as junk, or deleted the message. Since yours is not the only account,
the mail server is probably one of many in a data center.</li>
<li>Searching for a phrase online involves comparing your search term
against a massive database of all known sites, looking for matches. This
“query” operation can be straightforward, but building that database is
a <a href="https://en.wikipedia.org/wiki/MapReduce" class="external-link">monumental task</a>!
Servers are involved at every step.</li>
<li>Searching for directions on a mapping website involves connecting
your
<ol style="list-style-type: upper-alpha">
<li>starting and (B) end points by <a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm" class="external-link">traversing a
graph</a> in search of the “shortest” path by distance, time, expense,
or another metric. Converting a map into the right form is relatively
simple, but calculating all the possible routes between A and B is
expensive.</li>
</ol>
</li>
</ul>
<p>Checking email could be serial: your machine connects to one server
and exchanges data. Searching by querying the database for your search
term (or endpoints) could also be serial, in that one machine receives
your query and returns the result. However, assembling and storing the
full database is far beyond the capability of any one machine.
Therefore, these functions are served in parallel by a large, <a href="https://en.wikipedia.org/wiki/Hyperscale_computing" class="external-link">“hyperscale”</a>
collection of servers working together.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="hpc-research-examples">HPC research examples<a class="anchor" aria-label="anchor" href="#hpc-research-examples"></a>
</h2>
<hr class="half-width">
<p>Frequently, research problems that use computing can outgrow the
capabilities of the desktop or laptop computer where they started:</p>
<ul>
<li>A statistics student wants to cross-validate a model. This involves
running the model 1000 times — but each run takes an hour. Running the
model on a laptop will take over a month! In this research problem,
final results are calculated after all 1000 models have run, but
typically only one model is run at a time (in <strong>serial</strong>)
on the laptop. Since each of the 1000 runs is independent of all others,
and given enough computers, it’s theoretically possible to run them all
at once (in <strong>parallel</strong>).</li>
<li>A genomics researcher has been using small datasets of sequence
data, but soon will be receiving a new type of sequencing data that is
10 times as large. It’s already challenging to open the datasets on a
computer — analyzing these larger datasets will probably crash it. In
this research problem, the calculations required might be impossible to
parallelize, but a computer with <strong>more memory</strong> would be
required to analyze the much larger future data set.</li>
<li>An engineer is using a fluid dynamics package that has an option to
run in parallel. So far, this option was not utilized on a desktop. In
going from 2D to 3D simulations, the simulation time has more than
tripled. It might be useful to take advantage of that option or feature.
In this research problem, the calculations in each region of the
simulation are largely independent of calculations in other regions of
the simulation. It’s possible to run each region’s calculations
simultaneously (in <strong>parallel</strong>), communicate selected
results to adjacent regions as needed, and repeat the calculations to
converge on a final set of results. In moving from a 2D to a 3D model,
<strong>both the amount of data and the amount of calculations increases
greatly</strong>, and it’s theoretically possible to distribute the
calculations across multiple computers communicating over a shared
network.</li>
</ul>
<p>In all these cases, access to more (and larger) computers is needed.
Those computers should be usable at the same time, <strong>solving many
researchers’ problems in parallel</strong>.</p>
<div id="break-the-ice" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="break-the-ice" class="callout-inner">
<h3 class="callout-title">Break the Ice</h3>
<div class="callout-content">
<p>Talk to your neighbour, office mate or <a href="https://rubberduckdebugging.com/" class="external-link">rubber duck</a> about your
research.</p>
<ul>
<li>How does computing help you do your research?</li>
<li>How could more computing help you do more or better research?</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>The <em>cloud</em> is a generic term commonly used to refer to
computing resources that are a) <em>provisioned</em> to users on demand
or as needed and b) represent real or <em>virtual</em> resources that
may be located anywhere on Earth. For example, a large company with
computing resources in Brazil, Zimbabwe and Japan may manage those
resources as its own <em>internal</em> cloud and that same company may
also utilize commercial cloud resources provided by Amazon or Google.
Cloud resources may refer to machines performing relatively simple tasks
such as serving websites, providing shared storage, providing web
services (such as e-mail or social media platforms), as well as more
traditional compute intensive tasks such as running a simulation.</p>
<p>The term <em>HPC system</em>, on the other hand, describes a
stand-alone resource for computationally intensive workloads. They are
typically comprised of a multitude of integrated processing and storage
elements, designed to handle high volumes of data and/or large numbers
of floating-point operations (<a href="https://en.wikipedia.org/wiki/FLOPS" class="external-link">FLOPS</a>) with the highest
possible performance. For example, all of the machines on the <a href="https://www.top500.org" class="external-link">Top-500</a> list are HPC systems. To
support these constraints, an HPC resource must exist in a specific,
fixed location: networking cables can only stretch so far, and
electrical and optical signals can travel only so fast.</p>
<p>The word “cluster” is often used for small to moderate scale HPC
resources less impressive than the <a href="https://www.top500.org" class="external-link">Top-500</a>. Clusters are often maintained
in computing centers that support several such systems, all sharing
common networking and storage to support common compute intensive
tasks.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>High Performance Computing (HPC) typically involves connecting to
very large computing systems elsewhere in the world.</li>
<li>These other systems can be used to do work that would either be
impossible or much slower on smaller systems.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-20-cluster"><p>Content from <a href="20-cluster.html">Working on an HPC system</a></p>
<hr>
<p>Last updated on 2025-03-05 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/20-cluster.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I log on to an HPC system?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Connect to an HPC system.</li>
<li>Understand the general HPC system architecture.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="logging-in">Logging In<a class="anchor" aria-label="anchor" href="#logging-in"></a>
</h2>
<hr class="half-width">
<p>The first step in using a cluster is to establish a connection from
our laptop to the cluster. When we are sitting at a computer (or
standing, or holding it in our hands or on our wrists), we have come to
expect a visual display with icons, widgets, and perhaps some windows or
applications: a graphical user interface, or GUI. Since computer
clusters are remote resources that we often connect to over over slow or
laggy interfaces (WiFi and VPNs especially), it is more practical to use
a command-line interface, or CLI, in which commands and results are
transmitted via text, only. Anything other than text (images, for
example) must be written to disk and opened with a separate program.</p>
<p>If you have ever opened the Windows Command Prompt or macOS Terminal,
you have seen a CLI. If you have already taken The Carpentries’ courses
on the UNIX Shell or Version Control, you have used the CLI on your
local machine somewhat extensively. The only leap to be made here is to
open a CLI on a <em>remote</em> machine, while taking some precautions
so that other folks on the network can’t see (or change) the commands
you’re running or the results the remote machine sends back. We will use
the Secure SHell protocol (or SSH) to open an encrypted network
connection between two machines, allowing you to send &amp; receive text
and data without having to worry about prying eyes.</p>
<figure><img src="../fig/connect-to-remote.svg" alt="Connect to cluster" class="figure mx-auto d-block"><div class="figcaption">Connect to cluster</div>
</figure><p>Make sure you have a SSH client installed on your laptop. Refer to
the <a href="index.html">setup</a> section for more details. SSH clients
are usually command-line tools, where you provide the remote machine
address as the only required argument. If your username on the remote
system differs from what you use locally, you must provide that as well.
If your SSH client has a graphical front-end, such as PuTTY or
MobaXterm, you will set these arguments before clicking “connect.” From
the terminal, you’ll write something like
<code>ssh userName@hostname</code>, where the “@” symbol is used to
separate the two parts of a single argument.</p>
<p>Go ahead and open your terminal or graphical SSH client, then log in
to the cluster using your username.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ ssh userid@rocket.hpc.ncl.ac.uk</span></code></pre>
</div>
<p>Remember to replace <strong>userid</strong> with your username or the
one supplied by the instructors. You may be asked for your password.
Watch out: the characters you type after the password prompt are not
displayed on the screen. Normal output will resume once you press
<code>Enter</code>.</p>
</section><section><h2 class="section-heading" id="where-are-we">Where Are We?<a class="anchor" aria-label="anchor" href="#where-are-we"></a>
</h2>
<hr class="half-width">
<p>Very often, many users are tempted to think of a high-performance
computing installation as one giant, magical machine. Sometimes, people
will assume that the computer they’ve logged onto is the entire
computing cluster. So what’s really happening? What computer have we
logged on to? The name of the current computer we are logged onto can be
checked with the <code>hostname</code> command. (You may also notice
that the current hostname is also part of our prompt!)</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ hostname</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">login01.cluster</span></span></code></pre>
</div>
<div id="whats-in-your-home-directory" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="whats-in-your-home-directory" class="callout-inner">
<h3 class="callout-title">What’s in Your Home Directory?</h3>
<div class="callout-content">
<p>The system administrators may have configured your home directory
with some helpful files, folders, and links (shortcuts) to space
reserved for you on other filesystems. Take a look around and see what
you can find. <em>Hint:</em> The shell commands <code>pwd</code> and
<code>ls</code> may come in handy. Home directory contents vary from
user to user. Please discuss any differences you spot with your
neighbors.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> It’s a Beautiful Day in the Neighborhood </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The deepest layer should differ: <strong>userid</strong> is uniquely
yours. Are there differences in the path at higher levels?</p>
<p>If both of you have empty directories, they will look identical. If
you or your neighbor has used the system before, there may be
differences. What are you working on?</p>
<p>Use <code>pwd</code> to <strong>p</strong>rint the
<strong>w</strong>orking <strong>d</strong>irectory path:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  pwd</span></code></pre>
</div>
<p>You can run <code>ls</code> to <strong>l</strong>i<strong>s</strong>t
the directory contents, though it’s possible nothing will show up (if no
files have been provided). To be sure, use the <code>-a</code> flag to
show hidden files, too.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  ls <span class="at">-a</span></span></code></pre>
</div>
<p>At a minimum, this will show the current directory as <code>.</code>,
and the parent directory as <code>..</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="nodes">Nodes<a class="anchor" aria-label="anchor" href="#nodes"></a>
</h2>
<hr class="half-width">
<p>Individual computers that compose a cluster are typically called
<em>nodes</em> (although you will also hear people call them
<em>servers</em>, <em>computers</em> and <em>machines</em>). On a
cluster, there are different types of nodes for different types of
tasks. The node where you are right now is called the <em>head
node</em>, <em>login node</em>, <em>landing pad</em>, or <em>submit
node</em>. A login node serves as an access point to the cluster.</p>
<div id="avoid-running-jobs-on-the-login-node" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="avoid-running-jobs-on-the-login-node" class="callout-inner">
<h3 class="callout-title">Avoid running jobs on the login node !</h3>
<div class="callout-content">
<p>As a gateway, it is well suited for uploading and downloading files,
setting up software, and running quick tests. Generally speaking, the
login node should not be used for time-consuming or resource-intensive
tasks. You should be alert to this, and check with your site’s operators
or documentation for details of what is and isn’t allowed. In these
lessons, we will avoid running jobs on the login node.</p>
</div>
</div>
</div>
<p>The real work on a cluster gets done by the <em>worker</em> (or
<em>compute</em>) <em>nodes</em>. Worker nodes come in many shapes and
sizes, but generally are dedicated to long or hard tasks that require a
lot of computational resources.</p>
<p>All interaction with the worker nodes is handled by a specialized
piece of software called a scheduler (the scheduler used in this lesson
is called <strong>Slurm</strong>). We’ll learn more about how to use the
scheduler to submit jobs next, but for now, it can also tell us more
information about the worker nodes.</p>
<p>For example, we can view all of the worker nodes by running the
command <strong>sinfo</strong>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ sinfo</span></code></pre>
</div>
<pre><code>PARTITION   AVAIL  TIMELIMIT  NODES  STATE NODELIST
dell-gpu       up 21-00:00:0      1   idle gpu01
defq*          up 2-00:00:00      6   drng sb[019,025,029,062,069,073]
defq*          up 2-00:00:00      1  drain sb060
defq*          up 2-00:00:00     45    mix sb[001,003-004,006-007,009-012,014-015,017,023,027-028,032-036,038-039,041-045,047,050,053-054,058-059,061,066-068,072,078,084,086,092,104,108,110]
defq*          up 2-00:00:00     58  alloc sb[002,005,008,013,016,018,020-022,024,026,030-031,037,040,046,048-049,051-052,055-057,063-065,070-071,074-077,079-083,085,087-091,093-103,105-107,109]
short          up      10:00      6   drng sb[019,025,029,062,069,073]
</code></pre>
<p>There are also specialized machines used for managing disk storage,
user authentication, and other infrastructure-related tasks. Although we
do not typically logon to or interact with these machines directly, they
enable a number of key features like ensuring our user account and files
are available throughout the HPC system.</p>
</section><section><h2 class="section-heading" id="whats-in-a-node">What's in a Node?<a class="anchor" aria-label="anchor" href="#whats-in-a-node"></a>
</h2>
<hr class="half-width">
<p>All of the nodes in an HPC system have the same components as your
own laptop or desktop: <em>CPUs</em> (sometimes also called
<em>processors</em> or <em>cores</em>), <em>memory</em> (or
<em>RAM</em>), and <em>disk</em> space. CPUs are a computer’s tool for
actually running programs and calculations. Information about a current
task is stored in the computer’s memory. Disk refers to all storage that
can be accessed like a file system. This is generally storage that can
hold data permanently, i.e. data is still there even if the computer has
been restarted. While this storage can be local (a hard drive installed
inside of it), it is more common for nodes to connect to a shared,
remote fileserver or cluster of servers.</p>
<figure><img src="../fig/node_anatomy.png" max-width="20%" caption="" alt="Node anatomy" class="figure mx-auto d-block"><div class="figcaption">Node anatomy</div>
</figure><div id="explore-your-computer" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="explore-your-computer" class="callout-inner">
<h3 class="callout-title">Explore Your Computer</h3>
<div class="callout-content">
<p>Try to find out the number of CPUs and amount of memory available on
your personal computer. Note that, if you’re logged in to the remote
computer cluster, you need to log out first. To do so, type
<code>Ctrl+d</code> or <code>exit</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  exit</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ </span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>There are several ways to do this. Most operating systems have a
graphical system monitor, like the Windows Task Manager. More detailed
information can sometimes be found on the command line. For example,
some of the commands used on a Linux system are:</p>
<p>Run system utilities</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  nproc <span class="at">--all</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  free <span class="at">-m</span></span></code></pre>
</div>
<p>Read from <code>/proc</code></p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  cat /proc/cpuinfo</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  cat /proc/meminfo</span></code></pre>
</div>
<p>Run system monitor</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  htop</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="explore-the-login-node" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="explore-the-login-node" class="callout-inner">
<h3 class="callout-title">Explore the login node</h3>
<div class="callout-content">
<p>Now compare the resources of your computer with those of the login
node.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  ssh userid@rocket.hpc.ncl.ac.uk</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  nproc <span class="at">--all</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  free <span class="at">-m</span></span></code></pre>
</div>
<p>You can get more information about the processors using
<code>lscpu</code>, and a lot of detail about the memory by reading the
file <code>/proc/meminfo</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  less /proc/meminfo</span></code></pre>
</div>
<p>You can also explore the available filesystems using <code>df</code>
to show <strong>d</strong>isk <strong>f</strong>ree space. The
<code>-h</code> flag renders the sizes in a human-friendly format, i.e.,
GB instead of B. The <strong>t</strong>ype flag <code>-T</code> shows
what kind of filesystem each resource is.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  df <span class="at">-Th</span></span></code></pre>
</div>
<div id="different-results-from-df" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="different-results-from-df" class="callout-inner">
<h3 class="callout-title">Different results from <code>df</code>
</h3>
<div class="callout-content">
<ul>
<li>The local filesystems (ext, tmp, xfs, zfs) will depend on whether
you’re on the same login node (or compute node, later on).</li>
<li>Networked filesystems (beegfs, cifs, gpfs, nfs, pvfs) will be
similar — but may include userid, depending on how it is <a href="https://en.wikipedia.org/wiki/Mount_(computing)" class="external-link">mounted</a>.</li>
</ul>
</div>
</div>
</div>
<div id="shared-filesystems" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="shared-filesystems" class="callout-inner">
<h3 class="callout-title">Shared Filesystems</h3>
<div class="callout-content">
<p>This is an important point to remember: files saved on one node
(computer) are often available everywhere on the cluster!</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="explore-a-worker-node" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="explore-a-worker-node" class="callout-inner">
<h3 class="callout-title">Explore a Worker Node</h3>
<div class="callout-content">
<p>Finally, let’s look at the resources available on the worker nodes
where your jobs will actually run. Try running this command to see the
name, CPUs and memory available on one of the worker nodes:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  sinfo <span class="at">-n</span> <span class="at">-o</span> <span class="st">"%n %c %m"</span> <span class="at">-o</span> <span class="st">"%n %c %m"</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="compare-your-computer-the-login-node-and-the-compute-node" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="compare-your-computer-the-login-node-and-the-compute-node" class="callout-inner">
<h3 class="callout-title">Compare Your Computer, the login node and the compute node</h3>
<div class="callout-content">
<p>Compare your laptop’s number of processors and memory with the
numbers you see on the cluster login node and worker node. Discuss the
differences with your neighbor.</p>
<p>What implications do you think the differences might have on running
your research work on the different systems and nodes?</p>
</div>
</div>
</div>
<div id="differences-between-nodes" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="differences-between-nodes" class="callout-inner">
<h3 class="callout-title">Differences Between Nodes</h3>
<div class="callout-content">
<p>Many HPC clusters have a variety of nodes optimized for particular
workloads. Some nodes may have larger amount of memory, or specialized
resources such as Graphical Processing Units (GPUs).</p>
</div>
</div>
</div>
<p>With all of this in mind, we will now cover how to talk to the
cluster’s scheduler, and use it to start running our scripts and
programs!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>An HPC system is a set of networked machines.</li>
<li>HPC systems typically provide login nodes and a set of worker
nodes.</li>
<li>The standard method of interacting with such systems is via a
command line interface called Bash.</li>
<li>The resources found on independent (worker) nodes can vary in volume
and type (amount of RAM, processor architecture, availability of network
mounted filesystems, etc.).</li>
<li>Files saved on one node are available on all nodes.</li>
<li>Avoid running jobs on the login node</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-30-scheduler"><p>Content from <a href="30-scheduler.html">Working with the scheduler</a></p>
<hr>
<p>Last updated on 2025-03-05 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/30-scheduler.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 80 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a scheduler and why are they used?</li>
<li>How do I launch a program to run on any one node in the
cluster?</li>
<li>How do I capture the output of a program that is run on a node in
the cluster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Run a simple Hello World style program on the cluster.</li>
<li>Submit a simple Hello World style script to the cluster.</li>
<li>Use the batch system command line tools to monitor the execution of
your job.</li>
<li>Inspect the output and error files of your jobs.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="job-scheduler">Job Scheduler<a class="anchor" aria-label="anchor" href="#job-scheduler"></a>
</h2>
<hr class="half-width">
<p>An HPC system might have thousands of nodes and thousands of users.
How do we decide who gets what and when? How do we ensure that a task is
run with the resources it needs? This job is handled by a special piece
of software called the scheduler. On an HPC system, the scheduler
manages which jobs run where and when.</p>
<p>The following illustration compares these tasks of a job scheduler to
a waiter in a restaurant. If you can relate to an instance where you had
to wait for a while in a queue to get in to a popular restaurant, then
you may now understand why sometimes your job do not start instantly as
in your laptop.</p>
<figure><img src="../fig/restaurant_queue_manager.svg" caption="" alt="Compare a job scheduler to a waiter in a restaurant" class="figure mx-auto d-block"><div class="figcaption">The waiter scheduler</div>
</figure><p>The scheduler used in this lesson is Slurm. Although Slurm is not
used everywhere, running jobs is quite similar regardless of what
software is being used. The exact syntax might change, but the concepts
remain the same.</p>
</section><section><h2 class="section-heading" id="running-a-batch-job">Running a Batch Job<a class="anchor" aria-label="anchor" href="#running-a-batch-job"></a>
</h2>
<hr class="half-width">
<p>The most basic use of the scheduler is to run a command
non-interactively. Any command (or series of commands) that you want to
run on the cluster is called a <em>job</em>, and the process of using a
scheduler to run the job is called <em>batch job submission</em>.</p>
<p>In this case, the job we want to run is a shell script – essentially
a text file containing a list of UNIX commands to be executed in a
sequential manner. Our shell script will have three parts:</p>
<ul>
<li>On the very first line, add <code>#!/bin/bash</code>. The
<code>#!</code> (pronounced “hash-bang” or “shebang”) tells the computer
what program is meant to process the contents of this file. In this
case, we are telling it that the commands that follow are written for
the command-line shell (what we’ve been doing everything in so
far).</li>
<li>Anywhere below the first line, we’ll add an <code>echo</code>
command with a friendly greeting. When run, the shell script will print
whatever comes after <code>echo</code> in the terminal.
<ul>
<li>
<code>echo -n</code> will print everything that follows,
<em>without</em> ending the line by printing the new-line
character.</li>
</ul>
</li>
<li>On the last line, we’ll invoke the <code>hostname</code> command,
which will print the name of the machine the script is run on.</li>
<li>After our script is saved, we must make it executable, or linux
system security will not allow it to run. Use <code>chmod +x</code> to
do this.</li>
</ul>
<div id="substitute-your-username-for-userid" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="substitute-your-username-for-userid" class="callout-inner">
<h3 class="callout-title">Substitute your username for
<code>userid</code>
</h3>
<div class="callout-content">
<p>In all our examples, you will see <code>userid</code> in the place of
your own username.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  nano example-job.sh</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  chmod +x example-job.sh</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash

echo -n "This script is running on "
hostname</code></pre>
</div>
<div id="creating-our-test-job" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-our-test-job" class="callout-inner">
<h3 class="callout-title">Creating Our Test Job</h3>
<div class="callout-content">
<p>Run the script. Does it execute on the cluster or just our login
node?</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  ./example-job.sh</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on login01</code></pre>
</div>
<p>This job runs on the login node. <strong>!! Remember !!</strong> we
don’t run jobs on the login node unless they are very small test jobs
like this one.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="submit-a-job-to-the-scheduler">Submit a job to the scheduler<a class="anchor" aria-label="anchor" href="#submit-a-job-to-the-scheduler"></a>
</h2>
<hr class="half-width">
<p>If you completed the previous challenge successfully, you probably
realise that there is a distinction between running the job through the
scheduler and just “running it”. To submit this job to the scheduler, we
use the <code>sbatch</code> with the option
<code>--partition=short</code>.</p>
<div id="partitions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="partitions" class="callout-inner">
<h3 class="callout-title">Partitions</h3>
<div class="callout-content">
<p>The eagle eyed will have noticed a PARTITION column in the output of
<code>sinfo</code> in the previous episode. HPC systems divide resources
into partitions (or queues), for efficient scheduling.<br>
The ‘short’ partition only allows very short jobs (default 1 minute time
limit), which the scheduler can easily fit in the gaps between longer
jobs. Using ‘short’ is best for small test jobs as they don’t have to
wait in the queue behind bigger jobs.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Partitions on Rocket </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<pre><code>Partition (queue)	Nodes		Max concurrent 	Time limit (wallclock)	Default time limit (wallclock)	Default memory per core
defq			standard	528 cores	2 days			2 days				2.5 GB
bigmem			medium,large,XL	2 nodes		2 days(*)		2 days				11 GB
short			all		2 nodes		10 minutes		1 minute			2.5 GB
long			standard	2 nodes		30 days			5 days				2.5 GB
power(**)		power		1 node		2 days			2 days				2.5 GB
interactive		all		1 node		1 day or 2 hours idle time 2 hours			2.5 GB</code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  sbatch <span class="at">--partition</span><span class="op">=</span>short example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 36855</code></pre>
</div>
<p>Our work is done — now the scheduler takes over and tries to run the
job for us. While the job is waiting to run, it goes into a list of jobs
called the <em>queue</em>. To check on our job’s status, we check the
queue using the command <code>squeue -u userid</code>.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div id="did-it-work" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="did-it-work" class="callout-inner">
<h3 class="callout-title">Did it work?</h3>
<div class="callout-content">
<p>If you get an error, check that you have substituted your own
username for <code>userid</code> in the command above</p>
</div>
</div>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER   ST    TIME  NODES NODELIST(REASON)
36855 short         example- userid PD    0:00  1     (None)</code></pre>
</div>
<p>We can see all the details of our job, most importantly that it is in
the <code>R</code> or <code>RUNNING</code> state.</p>
<p>Sometimes our jobs might need to wait in a queue (<code>PD</code> or
<code>PENDING</code>) or become terminated, for example due to
<code>OUT_OF_MEMORY</code> (<code>OOM</code>) error,
<code>TIMEOUT</code> (<code>TO</code>) or some other <code>FAILED</code>
(<code>F</code>) condition.</p>
<p>Other states you may see are: <code>CA</code> (cancelled),
<code>CF</code>(configuring), <code>CG</code> (completing),
<code>CD</code> (completed), <code>NF</code> (node failure),
<code>RV</code> (revoked) and <code>SE</code> (special exit state).</p>
<div id="wheres-the-output" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="wheres-the-output" class="callout-inner">
<h3 class="callout-title">Where’s the Output?</h3>
<div class="callout-content">
<p>On the login node, this script printed output to the terminal — but
when we exit <code>watch</code>, there’s nothing. Where’d it go? HPC job
output is typically redirected to a file in the directory you launched
it from. Use <code>ls</code> to find and <code>cat</code> to read the
file.</p>
<p>On some HPC systems you may need to redirect the output explictly in
your job submission script. You can achieve this by setting the options
for error <code>--error=&lt;error_filename&gt;</code> and output
<code>--output=&lt;output_filename&gt;</code> filenames. On Rocket this
is handled by default with output and error files named according to the
job submission id.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="customising-a-job">Customising a Job<a class="anchor" aria-label="anchor" href="#customising-a-job"></a>
</h2>
<hr class="half-width">
<p>The job we just ran used some of the scheduler’s default options. In
a real-world scenario, that’s probably not what we want. The default
options represent a reasonable minimum. Chances are, we will need more
cores, more memory, more time, among other special considerations. To
get access to these resources we must customize our job script.</p>
<p>Comments in UNIX shell scripts (denoted by <code>#</code>) are
typically ignored, but there are exceptions. For instance the special
<code>#!</code> comment at the beginning of scripts specifies what
program should be used to run it (you’ll typically see
<code>#!/bin/bash</code>). Schedulers like Slurm also have a special
comment used to denote special scheduler-specific options. Though these
comments differ from scheduler to scheduler, Slurm’s special comment is
<code>#SBATCH</code>. Anything following the <code>#SBATCH</code>
comment is interpreted as an instruction to the scheduler.</p>
<p>Let’s illustrate this by example. By default, a job’s name is the
name of the script, but the <code>--job-name</code> option can be used
to change the name of a job. Add an option to the script:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --job-name new_name

echo -n "This script is running on "
hostname
echo "This script has finished successfully."</code></pre>
</div>
<p>Submit the job and monitor its status:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch <span class="at">--partition</span><span class="op">=</span>short example-job.sh</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID USER         ACCOUNT     NAME     ST REASON   START_TIME TIME TIME_LEFT NODES CPUS
38191 userid yourAccount new_name PD Priority N/A        0:00 1:00:00   1     1</code></pre>
</div>
<p>Fantastic, we’ve successfully changed the name of our job!</p>
<div class="section level3">
<h3 id="resource-requests">Resource Requests<a class="anchor" aria-label="anchor" href="#resource-requests"></a>
</h3>
<p>But what about more important changes, such as the number of cores
and memory for our jobs? One thing that is absolutely critical when
working on an HPC system is specifying the resources required to run a
job. This allows the scheduler to find the right time and place to
schedule our job. If you do not specify requirements (such as the amount
of time you need), you will likely be stuck with your site’s default
resources, which is probably not what you want.</p>
<p>The following are several key resource requests:</p>
<p><code>--account=&lt;project&gt;</code> your account is typically your
project code, for example <code>training</code>. Rocket does not charge
users but other HPCs use the –account option for charging to a project
budget.</p>
<p><code>--partition=&lt;partition&gt;</code> The partition specifies
the set of nodes you want to run on. More information on available
partitions is given in the <a href="https://www.ncl.ac.uk/itservice/research/hpc" class="external-link">Rocket
documentation</a>.</p>
<p>Other common options that are used are:</p>
<p><code>--time=&lt;hh:mm:ss&gt;</code> the maximum walltime for your
job. e.g. For a 6.5 hour walltime, you would use
<code>--time=06:30:00</code>.</p>
<p><code>--job-name=&lt;jobname&gt;</code> set a name for the job to
help identify it in Slurm command output.</p>
<p>In addition, parallel jobs will also need to specify how many nodes,
parallel processes and threads they require.</p>
<p><code>--exclusive</code> to ensure that you have exclusive access to
a compute node</p>
<p><code>--nodes=&lt;number&gt;</code> the number of nodes to use for
the job.</p>
<p><code>--tasks-per-node=&lt;processes per node&gt;</code> the number
of parallel processes (e.g. MPI ranks) per node.</p>
<p><code>--cpus-per-task=&lt;threads per task&gt;</code> the number of
threads per parallel process (e.g. number of OpenMP threads per MPI task
for hybrid MPI/OpenMP jobs). Note: you must also set the
<code>OMP_NUM_THREADS</code> environment variable if using OpenMP in
your job and usually add the <code>--cpu-bind=cores</code> option to
<code>srun</code></p>
<p>Note that just <em>requesting</em> these resources does not make your
job run faster, nor does it necessarily mean that you will consume all
of these resources. It only means that these are made available to you.
Your job may end up using less memory, or less time, or fewer tasks or
nodes, than you have requested, and it will still run.</p>
<p>It’s best if your requests accurately reflect your job’s
requirements. We’ll talk more about how to make sure that you’re using
resources effectively in a later episode of this lesson.</p>
<div id="command-line-options-or-job-script-options" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="command-line-options-or-job-script-options" class="callout-inner">
<h3 class="callout-title">Command line options or job script options?</h3>
<div class="callout-content">
<p>All of the options we specify can be supplied on the command line (as
we do here for <code>--partition=short</code>) or in the job script (as
we have done for the job name above). These are interchangeable. It is
often more convenient to put the options in the job script as it avoids
lots of typing at the command line.</p>
</div>
</div>
</div>
<div id="submitting-resource-requests" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="submitting-resource-requests" class="callout-inner">
<h3 class="callout-title">Submitting Resource Requests</h3>
<div class="callout-content">
<p>Modify our <code>hostname</code> script so that it runs for a minute,
then submit a job for it on the cluster. You should also move all the
options we have been specifying on the command line
(e.g. <code>--partition</code>) into the script at this point.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --time 00:01:15
#SBATCH --partition=short
echo -n "This script is running on "
sleep 60 # time in seconds
hostname
echo "This script has finished successfully."</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  sbatch example-job.sh</span></code></pre>
</div>
<p>Why are the Slurm runtime and <code>sleep</code> time not
identical?</p>
</div>
</div>
</div>
</div>
<div id="job-environment-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="job-environment-variables" class="callout-inner">
<h3 class="callout-title">Job environment variables</h3>
<div class="callout-content">
<p>When Slurm runs a job, it sets a number of environment variables for
the job. One of these will let us check what directory our job script
was submitted from. The <code>SLURM_SUBMIT_DIR</code> variable is set to
the directory from which our job was submitted.</p>
<p>Using the <code>SLURM_SUBMIT_DIR</code> variable, modify your job so
that it prints out the location from which the job was submitted.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  nano example-job.sh</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --partition=short
#SBATCH --time=00:01 # timeout in HH:MM

echo -n "This script is running on "
hostname

echo "This job was launched in the following directory:"
echo ${SLURM_SUBMIT_DIR}</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Resource requests are typically binding. If you exceed them, your job
will be killed. Let’s use walltime as an example. We will request 30
seconds of walltime, and attempt to run a job for two minutes.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --job-name long_job
#SBATCH --time 00:00:30
#SBATCH --partition=short

echo "This script is running on ... "
sleep 120 # time in seconds
hostname
echo "This script has finished successfully."</code></pre>
</div>
<p>Submit the job and wait for it to finish. Once it is has finished,
check the log file.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch example-job.sh</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat slurm-17866475.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on ...
slurmstepd: error: *** JOB 17866475 ON sb013 CANCELLED AT 2025-02-19T07:00:57 DUE TO TIME LIMIT ***</code></pre>
</div>
<p>Our job was killed for exceeding the amount of resources it
requested. Although this appears harsh, this is actually a feature.
Strict adherence to resource requests allows the scheduler to find the
best possible place for your jobs. Even more importantly, it ensures
that another user cannot use more resources than they’ve been given. If
another user messes up and accidentally attempts to use all of the cores
or memory on a node, Slurm will either restrain their job to the
requested resources or kill the job outright. Other jobs on the node
will be unaffected. This means that one user cannot mess up the
experience of others, the only jobs affected by a mistake in scheduling
will be their own.</p>
<div id="but-how-much-does-it-cost" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="but-how-much-does-it-cost" class="callout-inner">
<h3 class="callout-title">But how much does it cost?</h3>
<div class="callout-content">
<p>Rocket does not currently charge you to run jobs but other HPCs do
charge. Although your job will be killed if it exceeds the selected
runtime, a job that completes within the time limit is only charged for
the time it actually used. However, you should always try and specify a
wallclock limit that is close to (but greater than!) the expected
runtime as this will enable your job to be scheduled more quickly. If
you say your job will run for an hour, the scheduler has to wait until a
full hour becomes free on the machine. If it only ever runs for 5
minutes, you could have set a limit of 10 minutes and it might have been
run earlier in the gaps between other users’ jobs.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="cancelling-a-job">Cancelling a Job<a class="anchor" aria-label="anchor" href="#cancelling-a-job"></a>
</h2>
<hr class="half-width">
<p>Sometimes we’ll make a mistake and need to cancel a job. This can be
done with the <code>scancel</code> command. Let’s submit a job and then
cancel it using its job number (remember to change the walltime so that
it runs long enough for you to cancel it before it is killed!).</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch example-job.sh</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 38759

JOBID PARTITION     NAME     USER      ST    TIME  NODES NODELIST(REASON)
38759  short        long_job   ncb176  R     1:13      1 sb013</code></pre>
</div>
<p>Now cancel the job with its job number (printed in your terminal).
Absence of any job info indicates that the job has been successfully
cancelled.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  scancel 38759</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co"># It might take a minute for the job to disappear from the queue...</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</code></pre>
</div>
<div id="cancelling-multiple-jobs" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="cancelling-multiple-jobs" class="callout-inner">
<h3 class="callout-title">Cancelling multiple jobs</h3>
<div class="callout-content">
<p>We can also cancel all of our jobs at once using the <code>-u</code>
option. This will delete all jobs for a specific user (in this case us).
Note that you can only delete your own jobs. Try submitting multiple
jobs and then cancelling them all with
<code>scancel -u userid</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-types-of-jobs">Other Types of Jobs<a class="anchor" aria-label="anchor" href="#other-types-of-jobs"></a>
</h2>
<hr class="half-width">
<p>Up to this point, we’ve focused on running jobs in batch mode. Slurm
also provides the ability to start an interactive session.</p>
<p>There are very frequently tasks that need to be done interactively.
Creating an entire job script might be overkill, but the amount of
resources required is too much for a login node to handle. A good
example of this might be building a genome index for alignment with a
tool like <a href="https://ccb.jhu.edu/software/hisat2/index.shtml" class="external-link">HISAT2</a>.
Fortunately, we can run these types of tasks as a one-off with
<code>srun</code>.</p>
<p><code>srun</code> runs a single command in the queue system and then
exits. Let’s demonstrate this by running the <code>hostname</code>
command with <code>srun</code>. (We can cancel an <code>srun</code> job
with <code>Ctrl-c</code>.)</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun <span class="at">--partition</span><span class="op">=</span>short <span class="at">--time</span><span class="op">=</span>00:01:00 hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 17866477 queued and waiting for resources
srun: job 17866477 has been allocated resources
sb013.cluster</code></pre>
</div>
<p><code>srun</code> accepts all of the same options as
<code>sbatch</code>. However, instead of specifying these in a script,
these options are specified on the command-line when starting a job.</p>
<p>Typically, the resulting shell environment will be the same as that
for <code>sbatch</code>.</p>
<div class="section level3">
<h3 id="interactive-jobs">Interactive jobs<a class="anchor" aria-label="anchor" href="#interactive-jobs"></a>
</h3>
<p>Sometimes, you will need a lot of resource for interactive use.
Perhaps it’s our first time running an analysis or we are attempting to
debug something that went wrong with a previous job. Fortunately, SLURM
makes it easy to start an interactive job with <code>srun</code>:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun <span class="at">--partition</span><span class="op">=</span>short <span class="at">--pty</span> /bin/bash</span></code></pre>
</div>
<p>You should be presented with a bash prompt. Note that the prompt may
change to reflect your new location, in this case the compute node we
are logged on. You can also verify this with <code>hostname</code>.</p>
<p>When you are done with the interactive job, type <code>exit</code> to
quit your session.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“The scheduler handles how compute resources are shared between
users.”</li>
<li>“Everything you do should be run through the scheduler.”</li>
<li>“A job is just a shell script.”</li>
<li>“If in doubt, request more resources than you will need.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-40-modules"><p>Content from <a href="40-modules.html">Accessing software via Modules</a></p>
<hr>
<p>Last updated on 2025-03-05 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/40-modules.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we load and unload software packages?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how to load and use a software package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>On a high-performance computing system, it is seldom the case that
the software we want to use is available when we log in. It is
installed, but we will need to “load” it before it can run.</p>
<p>Before we start using individual software packages, however, we
should understand the reasoning behind this approach. The three biggest
factors are:</p>
<ul>
<li>software incompatibilities</li>
<li>versioning</li>
<li>dependencies</li>
</ul>
<p>Software incompatibility is a major headache for programmers.
Sometimes the presence (or absence) of a software package will break
others that depend on it. Two of the most famous examples are Python 2
and 3 and C compiler versions. Python 3 famously provides a
<code>python</code> command that conflicts with that provided by Python
2. Software compiled against a newer version of the C libraries and then
used when they are not present will result in a nasty
<code>'GLIBCXX_3.4.20' not found</code> error, for instance.</p>
<p>Software versioning is another common issue. A team might depend on a
certain package version for their research project - if the software
version was to change (for instance, if a package was updated), it might
affect their results. Having access to multiple software versions allow
a set of researchers to prevent software versioning issues from
affecting their results.</p>
<p>Dependencies are where a particular software package (or even a
particular version) depends on having access to another software package
(or even a particular version of another software package). For example,
the VASP materials science software may depend on having a particular
version of the FFTW (Fastest Fourier Transform in the West) software
library available for it to work.</p>
<section><h2 class="section-heading" id="environment-modules">Environment Modules<a class="anchor" aria-label="anchor" href="#environment-modules"></a>
</h2>
<hr class="half-width">
<p>Environment modules are the solution to these problems. A
<em>module</em> is a self-contained description of a software package —
it contains the settings required to run a software package and,
usually, encodes required dependencies on other software packages.</p>
<p>There are a number of different environment module implementations
commonly used on HPC systems: the two most common are <em>TCL
modules</em> and <em>Lmod</em>. Both of these use similar syntax and the
concepts are the same so learning to use one will allow you to use
whichever is installed on the system you are using. In both
implementations the <code>module</code> command is used to interact with
environment modules. An additional subcommand is usually added to the
command to specify what you want to do. For a list of subcommands you
can use <code>module -h</code> or <code>module help</code>. As for all
commands, you can access the full help on the <em>man</em> pages with
<code>man module</code>.</p>
<p>On login you may start out with a default set of modules loaded or
you may start out with an empty environment; this depends on the setup
of the system you are using.</p>
<div class="section level3">
<h3 id="listing-available-modules">Listing Available Modules<a class="anchor" aria-label="anchor" href="#listing-available-modules"></a>
</h3>
<p>To see available software modules, use <code>module avail</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  module avail</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>------------------------------------------- /mnt/storage/apps/at11.0/share/modules --------------------------------------------
   modulefiles/at11.0-powerpc64le-linux-gnu

---------------------------------------------- /mnt/storage/apps/eb/modules/all -----------------------------------------------
   ABINIT/8.2.2-intel-2017.03-GCC-6.3
   ABINIT/8.4.4-foss-2017b
   ABINIT/8.4.4-intel-2017.03-GCC-6.3
   ABINIT/8.10.1-intel-2018b
   ABINIT/9.4.2-foss-2021b                                          (D)
   ABRicate/1.0.0-gompi-2021a
   AFNI/20160329-intel-2017.03-GCC-6.3-Python-2.7.12
   ALE/1.0.0-foss-2021a
   ANSYS/17.0
   ANSYS/18.1
   ANSYS/19.4
   ANSYS/2020-R2
   ANSYS/2021
   ANSYS/2022-R1
   ANSYS/2024R1                                                     (D)
   ANTLR/2.7.7-GCCcore-11.2.0-Java-11.0.2
   ANTLR/2.7.7-GCCcore-11.3.0-Java-11.0.2                           (D)
   ANTs/2.3.1-foss-2018b-Python-3.6.6
   ANTs/2.3.2-foss-2019b-Python-3.7.4
   ANTs/2.3.5-foss-2021a                                            (D)
</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="listing-currently-loaded-modules">Listing Currently Loaded Modules<a class="anchor" aria-label="anchor" href="#listing-currently-loaded-modules"></a>
</h3>
<p>You can use the <code>module list</code> command to see which modules
you currently have loaded in your environment. If you have no modules
loaded, you will see a message telling you so</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$ module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No modules loaded</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="loading-and-unloading-software">Loading and Unloading Software<a class="anchor" aria-label="anchor" href="#loading-and-unloading-software"></a>
</h2>
<hr class="half-width">
<p>To load a software module, use <code>module load</code>. In this
example we will use Python 3.</p>
<p>Initially, Python 3 is not loaded. We can test this by using the
which command. which looks for programs the same way that Bash does, so
we can use it to tell us where a particular piece of software is
stored.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ which python3</span></code></pre>
</div>
<p>If the <code>python3</code> command was unavailable, we would see
output like</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/usr/bin/which: no python3 in (/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/mnt/nfs/home/userid/bin/:/opt/ibutils/bin:/mnt/nfs/home/userid/bin/:/mnt/nfs/home/userid/.local/bin:/mnt/nfs/home/userid/bin)</code></pre>
</div>
<p>Note that this wall of text is really a list, with values separated
by the : character. The output is telling us that the which command
searched the following directories for python3, without success:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">usr/local/bin</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">/usr/bin</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ex">/usr/local/sbin</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">/usr/sbin</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="ex">/mnt/nfs/home/userid/bin/</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="ex">/opt/ibutils/bin</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="ex">/mnt/nfs/home/userid/bin/</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="ex">/mnt/nfs/home/userid/.local/bin</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="ex">/mnt/nfs/home/userid/bin</span></span></code></pre>
</div>
<p>We can load the <code>python3</code> command with
<code>module load</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module load Python</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ which python3</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/mnt/storage/apps/eb/software/Python/3.7.0-foss-2018b/bin/python3</code></pre>
</div>
<p>So, what just happened?</p>
<p>To understand the output, first we need to understand the nature of
the <code>$PATH</code> environment variable. <code>$PATH</code> is a
special environment variable that controls where a UNIX system looks for
software. Specifically <code>$PATH</code> is a list of directories
(separated by <code>:</code>) that the OS searches through for a command
before giving up and telling us it can’t find it. As with all
environment variables we can print it out using <code>echo</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ echo <span class="va">$PATH</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/mnt/storage/apps/eb/software/Python/3.7.0-foss-2018b/bin:/mnt/storage/apps/eb/software/OpenSSL/1.1.0h-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/SQLite/3.24.0-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/Tcl/8.6.8-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/libreadline/7.0-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/ncurses/6.1-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/bzip2/1.0.6-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/FFTW/3.3.8-gompi-2018b/bin:/mnt/storage/apps/eb/software/OpenMPI/3.1.1-GCC-7.3.0-2.30/bin:/mnt/storage/apps/eb/software/hwloc/1.11.10-GCCcore-7.3.0/sbin:/mnt/storage/apps/eb/software/hwloc/1.11.10-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/libxml2/2.9.8-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/XZ/5.2.4-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/numactl/2.0.11-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/binutils/2.30-GCCcore-7.3.0/bin:/mnt/storage/apps/eb/software/GCCcore/7.3.0/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/mnt/nfs/home/userid/bin:/opt/ibutils/bin:/mnt/nfs/home/userid/.local/bin</code></pre>
</div>
<p>You’ll notice a similarity to the output of the <code>which</code>
command. In this case, there’s only one difference: the different
directory at the beginning. When we ran the <code>module load</code>
command, it added a directory to the beginning of our
<code>$PATH</code>. Let’s examine what’s there:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ ls /mnt/storage/apps/eb/software/Python/3.7.0-foss-2018b/bin</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2to3        cython            f2py     nosetests      pip3      python            python3.7m         pyvenv-3.7
2to3-3.7    cythonize         idle3    nosetests-3.7  pip3.7    python3           python3.7m-config  runxlrd.py
chardetect  easy_install      idle3.7  pbr            pydoc3    python3.7         python3-config     tabulate
cygdb       easy_install-3.7  netaddr  pip            pydoc3.7  python3.7-config  pyvenv             virtualenv</code></pre>
</div>
<p>Taking this to its conclusion, <code>module load</code> will add
software to your <code>$PATH</code>. It “loads” software. A special note
on this - depending on which version of the <code>module</code> program
that is installed at your site, <code>module load</code> will also load
required software dependencies.</p>
<p>To demonstrate, let’s use <code>module list</code>.
<code>module list</code> shows all loaded software modules.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currently Loaded Modules:
  1) GCCcore/7.3.0                     9) hwloc/1.11.10-GCCcore-7.3.0                 17) ncurses/6.1-GCCcore-7.3.0
  2) zlib/1.2.11-GCCcore-7.3.0        10) OpenMPI/3.1.1-GCC-7.3.0-2.30                18) libreadline/7.0-GCCcore-7.3.0
  3) binutils/2.30-GCCcore-7.3.0      11) OpenBLAS/0.3.1-GCC-7.3.0-2.30               19) Tcl/8.6.8-GCCcore-7.3.0
  4) GCC/7.3.0-2.30                   12) gompi/2018b                                 20) SQLite/3.24.0-GCCcore-7.3.0
  5) numactl/2.0.11-GCCcore-7.3.0     13) FFTW/3.3.8-gompi-2018b                      21) GMP/6.1.2-GCCcore-7.3.0
  6) XZ/5.2.4-GCCcore-7.3.0           14) ScaLAPACK/2.0.2-gompi-2018b-OpenBLAS-0.3.1  22) libffi/3.2.1-GCCcore-7.3.0
  7) libxml2/2.9.8-GCCcore-7.3.0      15) foss/2018b                                  23) OpenSSL/1.1.0h-GCCcore-7.3.0
  8) libpciaccess/0.14-GCCcore-7.3.0  16) bzip2/1.0.6-GCCcore-7.3.0                   24) Python/3.7.0-foss-2018b</code></pre>
</div>
<p>Let’s try unloading the Python module:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module unload Python</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[userid@login01 ~]$ module list

Currently Loaded Modules:
  1) GCCcore/7.3.0                     9) hwloc/1.11.10-GCCcore-7.3.0                 17) ncurses/6.1-GCCcore-7.3.0
  2) zlib/1.2.11-GCCcore-7.3.0        10) OpenMPI/3.1.1-GCC-7.3.0-2.30                18) libreadline/7.0-GCCcore-7.3.0
  3) binutils/2.30-GCCcore-7.3.0      11) OpenBLAS/0.3.1-GCC-7.3.0-2.30               19) Tcl/8.6.8-GCCcore-7.3.0
  4) GCC/7.3.0-2.30                   12) gompi/2018b                                 20) SQLite/3.24.0-GCCcore-7.3.0
  5) numactl/2.0.11-GCCcore-7.3.0     13) FFTW/3.3.8-gompi-2018b                      21) GMP/6.1.2-GCCcore-7.3.0
  6) XZ/5.2.4-GCCcore-7.3.0           14) ScaLAPACK/2.0.2-gompi-2018b-OpenBLAS-0.3.1  22) libffi/3.2.1-GCCcore-7.3.0
  7) libxml2/2.9.8-GCCcore-7.3.0      15) foss/2018b                                  23) OpenSSL/1.1.0h-GCCcore-7.3.0
  8) libpciaccess/0.14-GCCcore-7.3.0  16) bzip2/1.0.6-GCCcore-7.3.0</code></pre>
</div>
<p>So using <code>module unload</code> “un-loads” a module, and
depending on how a site is configured it may also unload all of the
dependencies (in our case it does not). If we wanted to unload
everything at once, we could run <code>module purge</code> (unloads
everything).</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module purge</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No modules loaded</code></pre>
</div>
<div id="more-on-modules" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-on-modules" class="callout-inner">
<h3 class="callout-title">More on modules</h3>
<div class="callout-content">
<p>Note that <code>module purge</code> is informative. It will also let
us know if a default set of “sticky” packages cannot be unloaded (and
how to actually unload these if we truly so desired).</p>
<p>Note that this module loading process happens principally through the
manipulation of environment variables like <code>$PATH</code>. There is
usually <strong>little or no data transfer</strong> involved.</p>
<p>The module loading process manipulates other special environment
variables as well, including variables that influence where the system
looks for <strong>software libraries</strong>, and sometimes variables
which tell commercial software packages where to find <strong>license
servers</strong>.</p>
<p>The module command also restores these shell environment variables to
their previous state when a module is unloaded.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="software-versioning">Software versioning<a class="anchor" aria-label="anchor" href="#software-versioning"></a>
</h2>
<hr class="half-width">
<p>So far, we’ve learned how to load and unload software packages. This
is very useful. However, we have not yet addressed the issue of software
versioning. At some point or other, you will run into issues where only
one particular version of some software will be suitable. Perhaps a key
bugfix only happened in a certain version, or version X broke
compatibility with a file format you use. In either of these example
cases, it helps to be very specific about what software is loaded.</p>
<p>Let’s look specifically for Python in <code>module avail</code>:
Because so many modules match <code>Python</code> we’ve cheated a little
and added <code>/3</code> focus down on Python 3 modules</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  module avail Python/3</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>----------------------- /mnt/storage/apps/eb/modules/all -----------------------
   GitPython/3.1.24-GCCcore-11.2.0
   Python/3.6.1-goolf-2017a
   Python/3.6.1-intel-2017.03-GCC-6.3
   Python/3.6.3-foss-2017b
   Python/3.6.6-foss-2018b
   Python/3.6.6-intel-2018b
   Python/3.7.0-foss-2018b                                   (D)
   Python/3.7.0-intel-2018b
   Python/3.7.2-GCCcore-8.2.0
   Python/3.7.4-GCCcore-8.3.0
   Python/3.7.5-GCCcore-8.3.0
   Python/3.8.2-GCCcore-9.3.0
   Python/3.8.6-GCCcore-10.2.0
   Python/3.9.5-GCCcore-10.3.0-bare
   Python/3.9.5-GCCcore-10.3.0
   Python/3.9.6-GCCcore-11.2.0-bare
   Python/3.9.6-GCCcore-11.2.0
   Python/3.10.4-GCCcore-11.3.0-bare
   Python/3.10.4-GCCcore-11.3.0
   Python/3.10.8-GCCcore-12.2.0-bare
   Python/3.10.8-GCCcore-12.2.0
   Python/3.11.3-GCCcore-12.3.0
   protobuf-python/3.3.0-intel-2017.03-GCC-6.3-Python-2.7.13
   protobuf-python/3.3.0-intel-2017.03-GCC-6.3-Python-3.6.1
   protobuf-python/3.13.0-foss-2020a-Python-3.8.2
   protobuf-python/3.14.0-GCCcore-10.2.0
   protobuf-python/3.17.3-GCCcore-10.3.0                     (D)

  Where:
   D:  Default Module

Use "module spider" to find all possible modules and extensions.
Use "module keyword key1 key2 ..." to search for all possible modules matching
any of the "keys".</code></pre>
</div>
<p>Note that we have several different versions of <code>Python3</code>.
In this case, <code>Python/3.7.0-foss-2018b</code> has a
<code>(D)</code> next to it. This indicates that it is the default - if
we type <code>module load Python</code>, this is the copy that will be
loaded.</p>
<div id="using-software-modules-in-scripts" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="using-software-modules-in-scripts" class="callout-inner">
<h3 class="callout-title">Using Software Modules in Scripts</h3>
<div class="callout-content">
<p>Create a job to report what version of python is running, uisng the
command <code>python3 --version</code>. Running a job is just like
logging on to the system (you should not assume a module loaded on the
login node is loaded on a compute node).</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  nano python-module.sh</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat python-module.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash

#SBATCH --partition=defq
#SBATCH --time=00:00:30

module load Python

python3 --version</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch python-module.sh</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="default-versions-and-module-swap">Default Versions and Module Swap<a class="anchor" aria-label="anchor" href="#default-versions-and-module-swap"></a>
</h2>
<hr class="half-width">
<p>Let’s take a closer look at the <code>gcc</code> module. GCC is an
extremely widely used C/C++/Fortran compiler. Lots of software is
dependent on the GCC version, and might not compile or run if the wrong
version is loaded. In this case, there are 18 different versions, named
like <code>GCC/12.2.0</code>. How do we load each copy and which copy is
the default?</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module avail gcc/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>---------------------------------------------------------------------------- /mnt/storage/apps/eb/modules/all -----------------------------------------------------------------------------
   GCC/4.8.2                  GCC/4.9.3-2.25    GCC/5.4.0-2.26    GCC/6.3.0-2.27    GCC/7.3.0-2.30      GCC/8.3.0    GCC/10.2.0    GCC/11.2.0    GCC/12.2.0
   GCC/4.9.3-binutils-2.25    GCC/5.2.0         GCC/6.1.0-2.27    GCC/6.4.0-2.28    GCC/8.2.0-2.31.1    GCC/9.3.0    GCC/10.3.0    GCC/11.3.0    GCC/12.3.0 (D)

  Where:
   D:  Default Module

Use "module spider" to find all possible modules and extensions.
Use "module keyword key1 key2 ..." to search for all possible modules matching any of the "keys".</code></pre>
</div>
<p>In this case, <code>GCC/12.3.0</code> has a <code>(D)</code> next to
it. This indicates that it is the default - if we type
<code>module load GCC</code>, this is the copy that will be loaded.
Let’s check this:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module purge</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module load GCC</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currently Loaded Modules:
  1) GCCcore/12.3.0   2) zlib/1.2.13-GCCcore-12.3.0   3) binutils/2.40-GCCcore-12.3.0   4) GCC/12.3.0</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ gcc <span class="at">--version</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gcc (GCC) 12.3.0
Copyright (C) 2022 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</code></pre>
</div>
<p>So how do we load the non-default copy of a software package? In this
case, the only change we need to make is be more specific about the
module we are loading. To load a non-default module, we need to make add
the version number after the / in our module load command:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module load GCC/11.2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following have been reloaded with a version change:
  1) GCC/12.3.0 =&gt; GCC/11.2.0             3) binutils/2.40-GCCcore-12.3.0 =&gt; binutils/2.37-GCCcore-11.2.0
  2) GCCcore/12.3.0 =&gt; GCCcore/11.2.0     4) zlib/1.2.13-GCCcore-12.3.0 =&gt; zlib/1.2.11-GCCcore-11.2.0</code></pre>
</div>
<p>What happened? The module command is teling us that it swapped out
<code>GCC/12.3.0</code> and replaced it with <code>GCC/11.2.0</code></p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ gcc <span class="at">--version</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gcc (GCC) 11.2.0
Copyright (C) 2021 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</code></pre>
</div>
<div id="cant-load-a-new-module-version" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="cant-load-a-new-module-version" class="callout-inner">
<h3 class="callout-title">can’t load a new module version?</h3>
<div class="callout-content">
<p>Sometimes the module command gives a warning requiring you to unload
the current version of a module before loading the new version. As
switching between different versions of the same module is often used
you can use <code>module swap</code> rather than unloading one version
before loading another. The equivalent of the steps above would be:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module purge</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module load GCC</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module swap GCC GCC/11.2.0</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following have been reloaded with a version change:
  1) GCC/12.3.0 =&gt; GCC/11.2.0             3) binutils/2.40-GCCcore-12.3.0 =&gt; binutils/2.37-GCCcore-11.2.0
  2) GCCcore/12.3.0 =&gt; GCCcore/11.2.0     4) zlib/1.2.13-GCCcore-12.3.0 =&gt; zlib/1.2.11-GCCcore-11.2.0</code></pre>
</div>
<p>And what happens when we load python again?</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ module load Python</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following have been reloaded with a version change:
  1) GCC/11.2.0 =&gt; GCC/7.3.0-2.30        3) binutils/2.37-GCCcore-11.2.0 =&gt; binutils/2.30-GCCcore-7.3.0
  2) GCCcore/11.2.0 =&gt; GCCcore/7.3.0     4) zlib/1.2.11-GCCcore-11.2.0 =&gt; zlib/1.2.11-GCCcore-7.3.0</code></pre>
</div>
<p>Because the version of python isn’t compatible with the currently
loaded version of gcc, module has done a swap for us.</p>
</div>
</div>
</div>
<div id="system-python" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="system-python" class="callout-inner">
<h3 class="callout-title">system python</h3>
<div class="callout-content">
<p>Watch out for system provided python, it may not be the version you
need. It’s best to always specify your python version. On Rocket, the
default version of Python is Python2. To confirm the version type
<code>python --version</code> which, on Rocket, will return
<code>Python 2.7.5</code>.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“Load software with <code>module load softwareName</code>.”</li>
<li>“Unload software with <code>module unload</code> or
<code>module purge</code>”</li>
<li>“The module system handles software versioning and package conflicts
for you automatically.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-50-transferring-files"><p>Content from <a href="50-transferring-files.html">Transferring files with remote computers</a></p>
<hr>
<p>Last updated on 2025-03-07 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/50-transferring-files.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I transfer files to (and from) the cluster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>
<code>wget</code> and <code>curl -O</code> download a file from the
internet.</li>
<li>
<code>scp</code> transfers files to and from your computer.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="required-files" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="required-files" class="callout-inner">
<h3 class="callout-title">Required Files</h3>
<div class="callout-content">
<p>The program used in this example can be retrieved using wget or a
browser on your laptop and then copied to the remote cluster.</p>
<p><strong>Using wget</strong>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ wget http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</span></code></pre>
</div>
<p><strong>Using a web browser</strong>:</p>
<p><a href="http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz" class="external-link">http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</a></p>
</div>
</div>
</div>
<p>Computing with a remote computer offers very limited use if we cannot
get files to or from the cluster. There are several options for
transferring data between computing resources, from command line options
to GUI programs, which we will cover here.</p>
<section><h2 class="section-heading" id="download-files-from-the-internet">Download Files From the Internet<a class="anchor" aria-label="anchor" href="#download-files-from-the-internet"></a>
</h2>
<hr class="half-width">
<p>One of the most straightforward ways to download files is to use
either <code>curl</code> or <code>wget</code>, one of these is usually
installed in most Linux shells, on Mac OS terminal and in GitBash. Any
file that can be downloaded in your web browser through a direct link
can be downloaded using <code>curl -O</code> or <code>wget</code>. This
is a quick way to download datasets or source code.</p>
<p>The syntax for these commands is:
<code>curl -O https://some/link/to/a/file</code> and
<code>wget https://some/link/to/a/file</code>. Try it out by downloading
some material we’ll use later on, from a terminal on your local
machine.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  curl <span class="at">-O</span> http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</span></code></pre>
</div>
<p>or</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  wget http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</span></code></pre>
</div>
<div id="tar.gz" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="tar.gz" class="callout-inner">
<h3 class="callout-title">
<code>tar.gz</code>?</h3>
<div class="callout-content">
<p>This is an archive file format, just like <code>.zip</code>, commonly
used and supported by default on Linux, which is the operating system
the majority of HPC cluster machines run. You may also see the extension
<code>.tgz</code>, which is exactly the same. We’ll talk more about
“tarballs,” since “tar-dot-g-z” is a mouthful, later on.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="transferring-single-files-and-folders-with-scp">Transferring Single Files and Folders With <code>scp</code>
<a class="anchor" aria-label="anchor" href="#transferring-single-files-and-folders-with-scp"></a>
</h2>
<hr class="half-width">
<p>To copy a single file to or from the cluster, we can use
<code>scp</code> (“secure copy”). The syntax can be a little complex for
new users, but we’ll break it down.</p>
<p>To <em>upload to</em> another computer:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  scp path/to/local/file.txt userid@rocket.hpc:/path/on/Rocket</span></code></pre>
</div>
<p>To <em>download from</em> another computer:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  scp userid@rocket.hpc:/path/on/Rocket/file.txt path/to/local/</span></code></pre>
</div>
<p>Note that everything after the <code>:</code> is optional. If you
don’t specify a path on the remote computer, the file will be
transferred to your home directory. It’s a good idea to be clear about
where you are putting the file though, so use <code>~/</code> to upload
to the top level in your home directory. (using the handy <code>~</code>
as shorthand your home directory.)</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  scp local-file.txt userid@rocket.hpc:</span></code></pre>
</div>
<div id="upload-a-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="upload-a-file" class="callout-inner">
<h3 class="callout-title">Upload a File</h3>
<div class="callout-content">
<p>Copy the file you just downloaded from the Internet to your home
directory on Rocket.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  scp hpc-intro-data.tar.gz userid@rocket.hpc:~/</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="can-you-download-to-the-cluster-directly" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="can-you-download-to-the-cluster-directly" class="callout-inner">
<h3 class="callout-title">Can you download to the cluster directly?</h3>
<div class="callout-content">
<p>Try downloading the file directly using <code>curl</code> or
<code>wget</code>. Do the commands understand file locations on your
local machine over SSH? Note that it may well fail, and that’s OK!</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Using <code>curl</code> or <code>wget</code> commands like the
following:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  ssh userid@rocket.hpc</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ curl <span class="at">-O</span> http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="ex">or</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ wget http://training.researchcomputing.ncl.ac.uk/training-materials/hpc-intro-data.tar.gz</span></code></pre>
</div>
<p>Did it work? If not, what does the terminal output tell you about
what happened?</p>
<div class="section level3">
<h3 id="why-not-download-directly-to-the-cluster">Why Not Download Directly to the cluster?<a class="anchor" aria-label="anchor" href="#why-not-download-directly-to-the-cluster"></a>
</h3>
<p>Some computer clusters are behind firewalls set to only allow
transfers initiated from the <em>outside</em>. This means that the
<code>curl</code> command will fail, as an address outside the firewall
is unreachable from the inside. To get around this, run the
<code>curl</code> or <code>wget</code> command from your local machine
to download the file, then use the <code>scp</code> command (just below
here) to upload it to the cluster.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="transferring-a-directory">Transferring a Directory<a class="anchor" aria-label="anchor" href="#transferring-a-directory"></a>
</h2>
<hr class="half-width">
<p>To copy a whole directory, we add the <code>-r</code> flag, for
“<strong>r</strong>ecursive”: copy the item specified, and every item
below it, and every item below those… until it reaches the bottom of the
directory tree rooted at the folder name you provided.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  scp <span class="at">-r</span> some-local-folder userid@rocket.hpc:target-directory/</span></code></pre>
</div>
<div id="caution" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="caution" class="callout-inner">
<h3 class="callout-title">Caution</h3>
<div class="callout-content">
<p>For a large directory — either in size or number of files — copying
with <code>-r</code> can take a long time to complete.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="whats-in-a">What’s in a <code>/</code>?<a class="anchor" aria-label="anchor" href="#whats-in-a"></a>
</h2>
<hr class="half-width">
<p>When using <code>scp</code>, you may have noticed that a
<code>:</code> <em>always</em> follows the remote computer name;
sometimes a <code>/</code> follows that, and sometimes not, and
sometimes there’s a final <code>/</code>. On Linux computers,
<code>/</code> is the <strong><em>root</em></strong> directory, the
location where the entire filesystem (and others attached to it) is
anchored. A path starting with a <code>/</code> is called
<em>absolute</em>, since there can be nothing above the root
<code>/</code>. A path that does not start with <code>/</code> is called
<em>relative</em>, since it is not anchored to the root.</p>
<p>If you want to upload a file to a location inside your home directory
— which is often the case — then you don’t need a leading
<code>/</code>. After the <code>:</code>, start writing the sequence of
folders that lead to the final storage location for the file or, as
mentioned above, provide nothing if your home directory <em>is</em> the
destination.</p>
<p>A trailing slash on the target directory is optional, and has no
effect for <code>scp -r</code>, but is important in other commands, like
<code>rsync</code>.</p>
</section><section><h2 class="section-heading" id="transferring-files-to-and-from-campus-storage-for-research-data-rdw">Transferring files to and from Campus Storage for Research Data
(RDW)<a class="anchor" aria-label="anchor" href="#transferring-files-to-and-from-campus-storage-for-research-data-rdw"></a>
</h2>
<hr class="half-width">
<p>RDW is mounted on Rocket at <code>/rdw</code>. You can use scp and
rsync to transfer data to RDW in the same way as copying to any other
directory on Rocket.</p>
<div class="section level3">
<h3 id="using-cp-to-copy-to-rdw">Using cp to copy to RDW<a class="anchor" aria-label="anchor" href="#using-cp-to-copy-to-rdw"></a>
</h3>
<p>Because <code>/rdw</code> is a mounted filesystem, we can use
<code>cp</code> instead of <code>scp</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ cp file.txt /rdw/03/rse-hpc/rockhpc_training_TEMP/userid/</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">[userid@login01</span> rse-hpc]$ cd /rdw/03/rse-hpc/rockhpc_training_TEMP/userid/</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$ pwd</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/rdw/03/rse-hpc/rockhpc_training_TEMP/userid</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$ ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">file.txt</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="using-rsync-to-copy-to-rdw">Using rsync to copy to RDW<a class="anchor" aria-label="anchor" href="#using-rsync-to-copy-to-rdw"></a>
</h3>
<p>As you gain experience with transferring files, you may find the
<code>scp</code> command limiting. The <a href="https://rsync.samba.org/" class="external-link">rsync</a> utility provides advanced
features for file transfer and is typically faster compared to both
<code>scp</code> and <code>sftp</code> (see below). It is especially
useful for transferring large and/or many files and creating synced
backup folders. The syntax is similar to <code>cp</code> and
<code>scp</code>. Rsync can be used on a locally mounted filesystem or a
remote filesystem.</p>
<p>Transfer <em>to</em> RDW from your work area on Rocket</p>
<div class="section level4">
<h4 id="try-out-a-dry-run">Try out a dry run:<a class="anchor" aria-label="anchor" href="#try-out-a-dry-run"></a>
</h4>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ rsync <span class="at">-av</span> testDir/ /rdw/03/rse-hpc/rockhpc_training_TEMP/userid <span class="at">--dry-run</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>sending incremental file list
./
file.txt
file2.txt

sent 119 bytes  received 25 bytes  288.00 bytes/sec
total size is 39  speedup is 0.27 (DRY RUN)</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="run-for-real">Run ‘for real’:<a class="anchor" aria-label="anchor" href="#run-for-real"></a>
</h4>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ rsync <span class="at">-av</span> testDir/ /rdw/03/rse-hpc/rockhpc_training_TEMP/userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
sending incremental file list
rsync: chgrp "/rdw/03/rse-hpc/rockhpc_training_TEMP/userid/." failed: Invalid argument (22)
./
file.txt
file2.txt
rsync: chgrp "/rdw/03/rse-hpc/rockhpc_training_TEMP/userid/.file.txt.SS0gps" failed: Invalid argument (22)
rsync: chgrp "/rdw/03/rse-hpc/rockhpc_training_TEMP/userid/.file2.txt.XAYkoB" failed: Invalid argument (22)

sent 234 bytes  received 376 bytes  1,220.00 bytes/sec
total size is 39  speedup is 0.06
rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1179) [sender=3.1.2]</code></pre>
</div>
<p>What happened? <code>rsync</code> returned an error.
<code>files/attrs were not transferred</code> This is because RDW
doesn’t ‘know’ about rocket’s groups. The transfer was successful
though! Only the ‘group’ attribute of the file couldn’t be transferred.
RDW has ‘trumped’ our local permissions and imposed its own standard
permissions. This isn’t important, the correct user keeps ownership of
the files.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ ls <span class="at">-l</span> testDir/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 4
-rw------- 1 userid rocketloginaccess  0 Feb 26 15:31 file2.txt
-rw------- 1 userid rocketloginaccess 39 Feb 26 15:31 file.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ ls <span class="at">-l</span> /rdw/03/rse-hpc/rockhpc_training_TEMP/userid/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 57
-rwxrwx--- 1 userid domainusers  0 Feb 26 15:52 file2.txt
-rwxrwx--- 1 userid domainusers 39 Feb 26 15:52 file.txt</code></pre>
</div>
<p>It’s still easier to read output without errors that we have to
ignore, so let’s remove that error.</p>
<p>The <code>-a</code> (archive) option preserves permissions, this is
why we see group modification errors above.<br>
For Rocket and RDW, replace <code>-av</code> with
<code>-rltv</code><br><code>-r</code> = recurse through subdirectories<br><code>-l</code> = copy symlinks<br><code>-t</code> = preserve timestamps<br><code>-v</code> = verbose</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ rsync <span class="at">-rltv</span> testDir/ /rdw/03/rse-hpc/rockhpc_training_TEMP/userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>sending incremental file list
./
file.txt
file2.txt

sent 203 bytes  received 57 bytes  </code></pre>
</div>
<div id="large-data-copies" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="large-data-copies" class="callout-inner">
<h3 class="callout-title">Large data copies</h3>
<div class="callout-content">
<p>When copying large amounts of data, rsync really comes into its own.
When you’re copying a lot of data, it’s important to keep track in case
the copy is interrupted. Rsync is great because it can pick up where it
left off, rather than starting the copy all over again. It’s also useful
to output to a log so you can see what was transferred and find any
errors that need to be addressed.</p>
<div class="section level3">
<h3 id="fast-connections">Fast Connections<a class="anchor" aria-label="anchor" href="#fast-connections"></a>
</h3>
<p>Transfers from Rocket to RDW don’t leave our fast data centre
network. If you’re using rsync with a fast network or disk to disk in
the same machine:</p>
<ul>
<li>DON’T use compression <code>-z</code>
</li>
<li>DO use <code>--inplace</code>
</li>
</ul>
<p>Why? compression uses lots of CPU, Rsync usually creates a temp file
on disk before copying. For fast transfers, this places too much load on
the CPU and hard drive.<br><code>--inplace</code> tells rsync not to create the temp file but send
the data straight away. It doesn’t matter if the connection is
interrupted, because rsync keeps track and tries again. Always re-run
transfer command to ensure nothing was missed. The second run should be
very fast, just listing all the files and not copying anything.</p>
</div>
<div class="section level3">
<h3 id="slow-connections">Slow Connections<a class="anchor" aria-label="anchor" href="#slow-connections"></a>
</h3>
<p>For a slow connection like the internet:</p>
<ul>
<li>DO use compression <code>-z</code>
</li>
<li>DON’T use <code>--inplace</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="special-case-large-transfers-using-rsync-on-the-same-filesytem-very-fast-connection">Special case: Large transfers using rsync on the same filesytem /
very fast connection<a class="anchor" aria-label="anchor" href="#special-case-large-transfers-using-rsync-on-the-same-filesytem-very-fast-connection"></a>
</h3>
<p>RDW has a super-fast connection to Rocket, which means that it takes
more resource to compress and un-compress the data than it does to do
the transfer</p>
<p>[<a href="mailto:userid@login01" class="email">userid@login01</a> ~]$
rsync -rltv testDir/ /rdw/03/rse-hpc/training/userid</p>
<p>The <code>-a</code> option preserves permissions, this is why we saw
group modification errors above. For Rocket and RDW, replace
<code>-av</code> with <code>-rltv</code><br><code>-v</code> = verbose<br><code>-r</code> = recurse through subdirectories<br><code>-l</code> = copy symlinks<br><code>-t</code> = preserve timestamps<br><code>--inplace --whole-file --size-only</code> to speed up transfer and
prevent rsync filling up space with a large temp directory<br><code>--itemize-changes --progress --stats</code> for more informative
output</p>
</div>
</div>
</div>
</div>
<div id="back-up-data-from-rocket-to-rdw" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="back-up-data-from-rocket-to-rdw" class="callout-inner">
<h3 class="callout-title">Back up data from rocket to RDW</h3>
<div class="callout-content">
<p>Set up an rsync command to copy files and provide helpful output to a
log file.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Try out a dry run:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">--dry-run</span> <span class="at">-avv</span> <span class="at">--inplace</span> <span class="at">--itemize-changes</span> <span class="at">--progress</span> <span class="at">--stats</span> <span class="at">--whole-file</span> <span class="at">--size-only</span> /nobackup/myusername/source /rdw/path/to/my/share/destination/ <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> /home/myusername/meaningful-log-name.log1</span></code></pre>
</div>
<p>Run ‘for real’:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avv</span> <span class="at">--inplace</span> <span class="at">--itemize-changes</span> <span class="at">--progress</span> <span class="at">--stats</span> <span class="at">--whole-file</span> <span class="at">--size-only</span> /nobackup/myusername/source /rdw/path/to/my/share/destination/ <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">tee</span> /home/myusername/meaningful-log-name.log2</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="a-note-on-ports" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="a-note-on-ports" class="callout-inner">
<h3 class="callout-title">A Note on Ports</h3>
<div class="callout-content">
<p>All file transfers using the above methods use SSH to encrypt data
sent through the network. So, if you can connect via SSH, you will be
able to transfer files. By default, SSH uses network port 22. If a
custom SSH port is in use, you will have to specify it using the
appropriate flag, often <code>-p</code>, <code>-P</code>, or
<code>--port</code>. Check <code>--help</code> or the <code>man</code>
page if you’re unsure.</p>
</div>
</div>
</div>
<div id="rsync-port" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rsync-port" class="callout-inner">
<h3 class="callout-title">Rsync Port</h3>
<div class="callout-content">
<p>Say we have to connect <code>rsync</code> through port 768 instead of
22. How would we modify this command?</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  rsync test.txt userid@rocket.hpc:</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  rsync <span class="at">--help</span> <span class="kw">|</span> <span class="fu">grep</span> port</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>     <span class="ex">--port=PORT</span>             specify double-colon alternate port number</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="ex">See</span> https://rsync.samba.org/ for updates, bug reports, and answers</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  rsync <span class="at">--port</span><span class="op">=</span>768 test.txt userid@rocket.hpc:</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="windows-users---transferring-files-interactively-with-mobaxterm">Windows Users - Transferring Files interactively with MobaXterm<a class="anchor" aria-label="anchor" href="#windows-users---transferring-files-interactively-with-mobaxterm"></a>
</h2>
<hr class="half-width">
<p>MobaXterm is a free ssh client. It allows connections via a ‘jump
host’ so can even be used from home.</p>
</section><section><h2 class="section-heading" id="archiving-files">Archiving Files<a class="anchor" aria-label="anchor" href="#archiving-files"></a>
</h2>
<hr class="half-width">
<p>One of the biggest challenges we often face when transferring data
between remote HPC systems is that of large numbers of files. There is
an overhead to transferring each individual file and when we are
transferring large numbers of files these overheads combine to slow down
our transfers to a large degree.</p>
<p>The solution to this problem is to <em>archive</em> multiple files
into smaller numbers of larger files before we transfer the data to
improve our transfer efficiency. Sometimes we will combine archiving
with <em>compression</em> to reduce the amount of data we have to
transfer and so speed up the transfer.</p>
<p>The most common archiving command you will use on a (Linux) HPC
cluster is <code>tar</code>. <code>tar</code> can be used to combine
files into a single archive file and, optionally, compress it.</p>
<p>Let’s start with the file we downloaded from the lesson site,
<code>hpc-lesson-data.tar.gz</code>. The “gz” part stands for
<em>gzip</em>, which is a compression library. Reading this file name,
it appears somebody took a folder named “hpc-lesson-data,” wrapped up
all its contents in a single file with <code>tar</code>, then compressed
that archive with <code>gzip</code> to save space. Let’s check using
<code>tar</code> with the <code>-t</code> flag, which prints the
“<strong>t</strong>able of contents” without unpacking the file,
specified by <code>-f &lt;filename&gt;</code>, on the remote computer.
Note that you can concatenate the two flags, instead of writing
<code>-t -f</code> separately.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  ssh userid@rocket.hpc</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ tar <span class="at">-tf</span> hpc-lesson-data.tar.gz</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="ex">hpc-intro-data/</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01971Z.txt</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/goostats</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/goodiff</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02040B.txt</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01978B.txt</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02043B.txt</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02018B.txt</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01843A.txt</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01978A.txt</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01751B.txt</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01736A.txt</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01812A.txt</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02043A.txt</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01729B.txt</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02040A.txt</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01843B.txt</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01751A.txt</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE01729A.txt</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a><span class="ex">hpc-intro-data/north-pacific-gyre/NENE02040Z.txt</span></span></code></pre>
</div>
<p>This shows a folder containing another folder, which contains a bunch
of files. If you’ve taken The Carpentries’ Shell lesson recently, these
might look familiar. Let’s see about that compression, using
<code>du</code> for “<strong>d</strong>isk <strong>u</strong>sage”.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ du <span class="at">-sh</span> hpc-lesson-data.tar.gz</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="ex">36K</span>     hpc-intro-data.tar.gz</span></code></pre>
</div>
<div id="files-occupy-at-least-one-block" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="files-occupy-at-least-one-block" class="callout-inner">
<h3 class="callout-title">Files Occupy at Least One “Block”</h3>
<div class="callout-content">
<p>If the filesystem block size is larger than 36 KB, you’ll see a
larger number: files cannot be smaller than one block.</p>
</div>
</div>
</div>
<p>Now let’s unpack the archive. We’ll run <code>tar</code> with a few
common flags:</p>
<ul>
<li>
<code>-x</code> to e<strong>x</strong>tract the archive</li>
<li>
<code>-v</code> for <strong>v</strong>erbose output</li>
<li>
<code>-z</code> for g<strong>z</strong>ip compression</li>
<li>
<code>-f</code> for the file to be unpacked</li>
</ul>
<p>When it’s done, check the directory size with <code>du</code> and
compare.</p>
<div id="extract-the-archive" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="extract-the-archive" class="callout-inner">
<h3 class="callout-title">Extract the Archive</h3>
<div class="callout-content">
<p>Using the four flags above, unpack the lesson data using
<code>tar</code>. Then, check the size of the whole unpacked directory
using <code>du</code>. Hint: <code>tar</code> lets you concatenate
flags.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Commands </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ tar <span class="at">-xvzf</span> hpc-lesson-data.tar.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01971Z.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">goostats</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">goodiff</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02040B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01978B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02043B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02018B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01843A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01978A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01751B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01736A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01812A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02043A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01729B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02040A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01843B.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01751A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE01729A.txt</span></span>
<span><span class="va">hpc</span><span class="op">-</span><span class="va">intro</span><span class="op">-</span><span class="va">data</span><span class="op">/</span><span class="va">north</span><span class="op">-</span><span class="va">pacific</span><span class="op">-</span><span class="va">gyre</span><span class="op">/</span><span class="va">NENE02040Z.txt</span></span></code></pre>
</div>
<p>Note that we did not type out <code>-x -v -z -f</code>, thanks to the
flag concatenation, though the command works identically either way.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$ du <span class="at">-sh</span> hpc-lesson-data</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="ex">144K</span>    hpc-intro-data</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="was-the-data-compressed" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="was-the-data-compressed" class="callout-inner">
<h3 class="callout-title">Was the Data Compressed?</h3>
<div class="callout-content">
<p>Text files compress nicely: the “tarball” is one-quarter the total
size of the raw data!</p>
</div>
</div>
</div>
<p>If you want to reverse the process — compressing raw data instead of
extracting it — set a <code>c</code> flag instead of <code>x</code>, set
the archive filename, then provide a directory to compress:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$  tar <span class="at">-cvzf</span> compressed_data.tar.gz hpc-intro-data</span></code></pre>
</div>
<div id="working-with-windows" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="working-with-windows" class="callout-inner">
<h3 class="callout-title">Working with Windows</h3>
<div class="callout-content">
<p>When you transfer text files to from a Windows system to a Unix
system (Mac, Linux, BSD, Solaris, etc.) this can cause problems. Windows
encodes its files slightly different than Unix, and adds an extra
character to every line. On a Unix system, every line in a file ends
with a <code>\n</code> (newline). On Windows, every line in a file ends
with a <code>\r\n</code> (carriage return + newline). This causes
problems sometimes. Though most modern programming languages and
software handles this correctly, in some rare instances, you may run
into an issue. The solution is to convert a file from Windows to Unix
encoding with the <code>dos2unix</code> command. You can identify if a
file has Windows line endings with <code>cat -A filename</code>. A file
with Windows line endings will have <code>^M$</code> at the end of every
line. A file with Unix line endings will have <code>$</code> at the end
of a line. To convert the file, just run <code>dos2unix filename</code>.
(Conversely, to convert back to Windows format, you can run
<code>unix2dos filename</code>.)</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“<code>wget</code> and <code>curl -O</code> download a file from the
internet.”</li>
<li>“<code>scp</code> transfers files to and from your computer.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-60-parallel-job"><p>Content from <a href="60-parallel-job.html">Running a parallel job</a></p>
<hr>
<p>Last updated on 2025-03-06 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/60-parallel-job.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>“How do we execute a task in parallel?”</li>
<li>“What benefits arise from parallel execution?”</li>
<li>“What are the limits of gains from execution in parallel?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>“Construct a program that can execute in parallel.”</li>
<li>“Prepare a job submission script for the parallel executable.”</li>
<li>“Launch jobs with parallel execution.”</li>
<li>“Record and summarize the timing and accuracy of jobs.”</li>
<li>“Describe the relationship between job parallelism and
performance.”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We now have the tools we need to run a multi-processor job. This is a
very important aspect of HPC systems, as parallelism is one of the
primary tools we have to improve the performance of computational
tasks.</p>
<p>Our example implements a method for estimating the value of π, the
ratio of the circumference to the diameter of a circle.<br>
The program generates a large number of random points on a 1×1 square
centered on (½,½), and checks how many of these points fall inside the
unit circle. On average, π/4 of the randomly-selected points should fall
in the circle, so π can be estimated from 4<em>f</em>, where <em>f</em>
is the observed fraction of points that fall in the circle. Because each
sample is independent, this algorithm is easily implemented in
parallel.</p>
<figure><img src="../fig/pi.png" alt="Algorithm for computing pi through random sampling" class="figure mx-auto d-block"><div class="figcaption">estimating pi from random points</div>
</figure><section><h2 class="section-heading" id="get-code-for-this-episode">Get code for this episode<a class="anchor" aria-label="anchor" href="#get-code-for-this-episode"></a>
</h2>
<hr class="half-width">
<p>The Python code you will use in this episode has been pre-written and
you can obtain a copy by: Method 1: Use the commands <code>curl</code>
or <code>wget</code> from the previous episode to download the files
directly into your working directory on Rocket and extract the archive.
Remember you will need to specify the path to these Python files in your
job submission scripts. It may be useful to <code>cd</code> into this
directory or <code>mv</code> the contents directly to the path
<code>/nobackup/proj/training/userid</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[userid@rocket.hpc</span> ~]$ curl <span class="at">-O</span> https://nclrse-training.github.io/hpc-intro-cirrus/files/python-pi-code.tar.gz</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">[userid@rocket.hpc</span> ~]$ tar <span class="at">-xvzf</span> python-pi-code.tar.gz</span></code></pre>
</div>
<p>or</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[userid@rocket.hpc</span> ~]$ wget https://nclrse-training.github.io/hpc-intro-cirrus/files/python-pi-code.tar.gz</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">[userid@rocket.hpc</span> ~]$ tar <span class="at">-xvzf</span> python-pi-code.tar.gz</span></code></pre>
</div>
<p>Method 2: You can download a local copy of the files on your machine
and then use <code>scp</code> or <code>rsync</code> to copy the file
onto Rocket.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ scp pi.py userid@rocket.hpc:/nobackup/proj/training/userid</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ scp pi-mpi-cirrus.py userid@rocket.hpc:/nobackup/proj/training/userid</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="a-serial-solution-to-the-problem">A Serial Solution to the Problem<a class="anchor" aria-label="anchor" href="#a-serial-solution-to-the-problem"></a>
</h2>
<hr class="half-width">
<p>We start from a Python script using concepts taught in Software
Carpentry’s <a href="https://swcarpentry.github.io/python-novice-inflammation/" class="external-link">Programming
with Python</a> workshops. We want to allow the user to specify how many
random points should be used to calculate π through a command-line
parameter. This script will only use a single CPU for its entire run, so
it’s classified as a serial process.</p>
<p>Let’s write a Python program, <code>pi.py</code>, to estimate π for
us. Start by importing the <code>numpy</code> module for calculating the
results, and the <code>sys</code> module to process command-line
parameters:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">import</span> sys</span></code></pre>
</div>
<p>We define a Python function <code>inside_circle</code> that accepts a
single parameter for the number of random points used to calculate π.
See <a href="https://swcarpentry.github.io/python-novice-inflammation/08-func/index.html" class="external-link">Programming
with Python: Creating Functions</a> for a review of Python functions. It
randomly samples points with both <em>x</em> and <em>y</em> on the
half-open interval [0, 1). It then computes their distances from the
origin (i.e., radii), and returns how many of those distances were less
than or equal to 1.0. All of this is done using <em>vectors</em> of
double-precision (64-bit) floating-point values.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> inside_circle(total_count):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    x <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    y <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    radii <span class="op">=</span> np.sqrt(x <span class="op">*</span> x <span class="op">+</span> y <span class="op">*</span> y)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    count <span class="op">=</span> <span class="bu">len</span>(radii[np.where(radii<span class="op">&lt;=</span><span class="fl">1.0</span>)])</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="cf">return</span> count</span></code></pre>
</div>
<p>Next, we create a main function to call the
<code>inside_circle</code> function and calculate π from its returned
result. See <a href="https://swcarpentry.github.io/python-novice-inflammation/12-cmdline/index.html" class="external-link">Programming
with Python: Command-Line Programs</a> for a review of <code>main</code>
functions and parsing command-line parameters.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    n_samples <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    counts <span class="op">=</span> inside_circle(n_samples)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    my_pi <span class="op">=</span> <span class="fl">4.0</span> <span class="op">*</span> counts <span class="op">/</span> n_samples</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="bu">print</span>(my_pi)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    main()</span></code></pre>
</div>
<div id="run-the-code-on-your-development-machine-e.g.-your-laptop" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="run-the-code-on-your-development-machine-e.g.-your-laptop" class="callout-inner">
<h3 class="callout-title">Run the code on your development machine (e.g. your laptop)</h3>
<div class="callout-content">
<p>A normal workflow would be to develop and run scripts on your own
machine, then move the working code up to HPC if more resource is needed
to run it. If you have Python installed on your lapotop, feel free to
try this out: If we run the Python script locally with a command-line
parameter, as in <code>python pi.py 1024</code>, we should see the
script print its estimate of π:</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ python pi.py 1024</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">3.04296875</span></span></code></pre>
</div>
<div id="try-out-code-on-the-login-node" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="try-out-code-on-the-login-node" class="callout-inner">
<h3 class="callout-title">Try out code on the login node ?</h3>
<div class="callout-content">
<p>We only run small test jobs on the login node. Rather than have the
whole class attempt this and block up the login node, your instructor
will run the code as a demonstration: :::solution on Rocket, software is
only available via modules, so we need to load Python3 before we
start:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[userid@rocket.hpc]$</span> module load Python</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">[userid@rocket.hpc]$</span> python pi.py 1024</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="ex">3.04296875</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>:::</p>
</section><section><h2 class="section-heading" id="random-number-generation">Random Number Generation<a class="anchor" aria-label="anchor" href="#random-number-generation"></a>
</h2>
<hr class="half-width">
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>In the preceding code, random numbers are conveniently generated
using the built-in capabilities of NumPy. In general, random-number
generation is difficult to do well, it’s easy to accidentally introduce
correlations into the generated sequence.</p>
<ul>
<li>Discuss why generating high quality random numbers might be
difficult.</li>
<li>Is the quality of random numbers generated sufficient for estimating
π in this implementation?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ul>
<li>Computers are deterministic and produce pseudo random numbers using
an algorithm. The choice of algorithm and its parameters determines how
random the generated numbers are. Pseudo random number generation
algorithms usually produce a sequence numbers taking the previous output
as an input for generating the next number. At some point the sequence
of pseudo random numbers will repeat, so care is required to make sure
the repetition period is long and that the generated numbers have
statistical properties similar to those of true random numbers.</li>
<li>Yes.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="measuring-performance-of-the-serial-solution">Measuring Performance of the Serial Solution<a class="anchor" aria-label="anchor" href="#measuring-performance-of-the-serial-solution"></a>
</h2>
<hr class="half-width">
<p>The stochastic method used to estimate π should converge on the true
value as the number of random points increases. But as the number of
points increases, creating the variables <code>x</code>, <code>y</code>,
and <code>radii</code> requires more time and more memory. Eventually,
the memory required may exceed what’s available on our local laptop or
desktop, or the time required may be too long to meet a deadline. So
we’d like to take some measurements of how much memory and time the
script requires, and later take the same measurements after creating a
parallel version of the script to see the benefits of parallelizing the
calculations required.</p>
<div class="section level3">
<h3 id="estimating-memory-requirements">Estimating Memory Requirements<a class="anchor" aria-label="anchor" href="#estimating-memory-requirements"></a>
</h3>
<p>Since the largest variables in the script are <code>x</code>,
<code>y</code>, and <code>radii</code>, each containing
<code>n_samples</code> points, we’ll modify the script to report their
total memory required. Each point in <code>x</code>, <code>y</code>, or
<code>radii</code> is stored as a NumPy <code>float64</code>, we can use
NumPy’s <a href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html" class="external-link"><code>dtype</code></a>
function to calculate the size of a <code>float64</code>.</p>
<p>Replace the <code>print(my_pi)</code> line with the following:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>size_of_float <span class="op">=</span> np.dtype(np.float64).itemsize</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>memory_required <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> n_samples <span class="op">*</span> size_of_float <span class="op">/</span> (<span class="dv">1024</span><span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pi: </span><span class="sc">{</span>my_pi<span class="sc">}</span><span class="ss">, memory: </span><span class="sc">{</span>memory_required<span class="sc">}</span><span class="ss"> GiB"</span>)</span></code></pre>
</div>
<p>The first line calculates the bytes of memory required for a single
64-bit floating point number using the <code>dtype</code> function. The
second line estimates the total amount of memory required to store three
variables containing <code>n_samples</code> <code>float64</code> values,
converting the value into units of <a href="https://en.wikipedia.org/wiki/Byte#Multiple-byte_units" class="external-link">gibibytes</a>.
The third line prints both the estimate of π and the estimated amount of
memory used by the script.</p>
<p>The updated Python script is:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="kw">def</span> inside_circle(total_count):</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    x <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    y <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    radii <span class="op">=</span> np.sqrt(x <span class="op">*</span> x <span class="op">+</span> y <span class="op">*</span> y)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    count <span class="op">=</span> <span class="bu">len</span>(radii[np.where(radii<span class="op">&lt;=</span><span class="fl">1.0</span>)])</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="cf">return</span> count</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    n_samples <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    counts <span class="op">=</span> inside_circle(n_samples)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    my_pi <span class="op">=</span> <span class="fl">4.0</span> <span class="op">*</span> counts <span class="op">/</span> n_samples</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    size_of_float <span class="op">=</span> np.dtype(np.float64).itemsize</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>    memory_required <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> n_samples <span class="op">*</span> size_of_float <span class="op">/</span> (<span class="dv">1024</span><span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pi: </span><span class="sc">{</span>my_pi<span class="sc">}</span><span class="ss">, memory: </span><span class="sc">{</span>memory_required<span class="sc">}</span><span class="ss"> GiB"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>Run the script again with a few different values for the number of
samples, and see how the memory required changes:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ python pi.py 1000</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">Pi:</span> 3.144, memory: 2.2351741790771484e-05 GiB</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ python pi.py 2000</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="ex">Pi:</span> 3.18, memory: 4.470348358154297e-05 GiB</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ python pi.py 1000000</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="ex">Pi:</span> 3.140944, memory: 0.022351741790771484 GiB</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ python pi.py 100000000</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="ex">Pi:</span> 3.14182724, memory: 2.2351741790771484 GiB</span></code></pre>
</div>
<p>Here we can see that the estimated amount of memory required scales
linearly with the number of samples used. In practice, there is some
memory required for other parts of the script, but the <code>x</code>,
<code>y</code>, and <code>radii</code> variables are by far the largest
influence on the total amount of memory required.</p>
</div>
<div class="section level3">
<h3 id="estimating-calculation-time">Estimating Calculation Time<a class="anchor" aria-label="anchor" href="#estimating-calculation-time"></a>
</h3>
<p>Most of the calculations required to estimate π are in the
<code>inside_circle</code> function:</p>
<ol style="list-style-type: decimal">
<li>Generating <code>n_samples</code> random values for <code>x</code>
and <code>y</code>.</li>
<li>Calculating <code>n_samples</code> values of <code>radii</code> from
<code>x</code> and <code>y</code>.</li>
<li>Counting how many values in <code>radii</code> are under 1.0.</li>
</ol>
<p>There’s also one multiplication operation and one division operation
required to convert the <code>counts</code> value to the final estimate
of π in the main function.</p>
<p>A simple way to measure the calculation time is to use Python’s
<code>datetime</code> module to store the computer’s current date and
time before and after the calculations, and calculate the difference
between those times.</p>
<p>To add the time measurement to the script, add the following line
below the <code>import sys</code> line:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> datetime</span></code></pre>
</div>
<p>Then, add the following line immediately above the line calculating
<code>counts</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>start_time <span class="op">=</span> datetime.datetime.now()</span></code></pre>
</div>
<p>Add the following two lines immediately below the line calculating
<code>counts</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>end_time <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>elapsed_time <span class="op">=</span> (end_time <span class="op">-</span> start_time).total_seconds()</span></code></pre>
</div>
<p>And finally, modify the <code>print</code> statement with the
following:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pi: </span><span class="sc">{</span>my_pi<span class="sc">}</span><span class="ss">, memory: </span><span class="sc">{</span>memory_required<span class="sc">}</span><span class="ss"> GiB, time: </span><span class="sc">{</span>elapsed_time<span class="sc">}</span><span class="ss"> s"</span>)</span></code></pre>
</div>
<p>The final Python script for the serial solution is:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="kw">def</span> inside_circle(total_count):</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    x <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    y <span class="op">=</span> np.random.uniform(size<span class="op">=</span>total_count)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    radii <span class="op">=</span> np.sqrt(x <span class="op">*</span> x <span class="op">+</span> y <span class="op">*</span> y)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    count <span class="op">=</span> <span class="bu">len</span>(radii[np.where(radii<span class="op">&lt;=</span><span class="fl">1.0</span>)])</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    <span class="cf">return</span> count</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    n_samples <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    start_time <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>    counts <span class="op">=</span> inside_circle(n_samples)</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>    my_pi <span class="op">=</span> <span class="fl">4.0</span> <span class="op">*</span> counts <span class="op">/</span> n_samples</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    end_time <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>    elapsed_time <span class="op">=</span> (end_time <span class="op">-</span> start_time).total_seconds()</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>    size_of_float <span class="op">=</span> np.dtype(np.float64).itemsize</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>    memory_required <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> n_samples <span class="op">*</span> size_of_float <span class="op">/</span> (<span class="dv">1024</span><span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pi: </span><span class="sc">{</span>my_pi<span class="sc">}</span><span class="ss">, memory: </span><span class="sc">{</span>memory_required<span class="sc">}</span><span class="ss"> GiB, time: </span><span class="sc">{</span>elapsed_time<span class="sc">}</span><span class="ss"> s"</span>)</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>Run the script again with a few different values for the number of
samples, and see how the solution time changes:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>[user<span class="op">@</span>laptop <span class="op">~</span>]$ python pi.py <span class="dv">1000000</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>Pi: <span class="fl">3.139612</span>, memory: <span class="fl">0.022351741790771484</span> GiB, time: <span class="fl">0.034872</span> s</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>[user<span class="op">@</span>laptop <span class="op">~</span>]$ python pi.py <span class="dv">10000000</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>Pi: <span class="fl">3.1425492</span>, memory: <span class="fl">0.22351741790771484</span> GiB, time: <span class="fl">0.351212</span> s</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>[user<span class="op">@</span>laptop <span class="op">~</span>]$ python pi.py <span class="dv">100000000</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>Pi: <span class="fl">3.14146608</span>, memory: <span class="fl">2.2351741790771484</span> GiB, time: <span class="fl">3.735195</span> s</span></code></pre>
</div>
<p>Here we can see that the amount of time required scales approximately
linearly with the number of samples used. There could be some variation
in additional runs of the script with the same number of samples, since
the elapsed time is affected by other programs running on the computer
at the same time. But if the script is the most
computationally-intensive process running at the time, its calculations
are the largest influence on the elapsed time.</p>
<p>Now that we’ve developed our initial script to estimate π, we can see
that as we increase the number of samples:</p>
<ol style="list-style-type: decimal">
<li>The estimate of π tends to become more accurate.</li>
<li>The amount of memory required scales approximately linearly.</li>
<li>The amount of time to calculate scales approximately linearly.</li>
</ol>
<p>In general, achieving a better estimate of π requires a greater
number of points. Take a closer look at <code>inside_circle</code>:
should we expect to get high accuracy on a single machine?</p>
<p>Probably not. The function allocates three arrays of size <em>N</em>
equal to the number of points belonging to this process. Using 64-bit
floating point numbers, the memory footprint of these arrays can get
quite large. Each 100,000,000 points sampled consumes 2.24 GiB of
memory. Sampling 400,000,000 points consumes 8.94 GiB of memory, and if
your machine has less RAM than that, it will grind to a halt. If you
have 16 GiB installed, you won’t quite make it to 750,000,000
points.</p>
</div>
</section><section><h2 class="section-heading" id="running-the-serial-job-on-a-compute-node">Running the Serial Job on a Compute Node<a class="anchor" aria-label="anchor" href="#running-the-serial-job-on-a-compute-node"></a>
</h2>
<hr class="half-width">
<p>Replicate the <code>pi.py</code> script in the
<code>/nobackup/proj/training/userid</code> space on Rocket. Guidance on
how to do this can be found at the beginning of this episode.</p>
<p>Create a submission file, requesting one task on a single node. If we
do not specify a maximum walltime for the job using
<code>--time=&lt;hh:mm:ss&gt;</code> then the job will be submitted with
the <code>short</code> default maximum time of 1 minute (NB partition
names and default time limits will vary between HPC systems).</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  nano serial-pi.sh</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  cat serial-pi.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --partition=short
#SBATCH --job-name serial-pi
#SBATCH --nodes=1
#SBATCH --tasks-per-node=1


# Load the correct Python module
module load python/3.9.13

# Execute the task
python3 pi.py 100000000</code></pre>
</div>
<div id="memory-requirements" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="memory-requirements" class="callout-inner">
<h3 class="callout-title">Memory Requirements</h3>
<div class="callout-content">
<p>On some HPC systems you may need to specify the memory requirements
of the job using the <code>--mem</code>, <code>--mem-per-cpu</code>,
<code>--mem-per-gpu</code> options. However, on Cirrus you cannot
specify the memory for a job. The amount of memory you are assigned is
calculated from the amount of primary resource you request.</p>
<p>The primary resource you request on standard compute nodes are CPU
cores. The maximum amount of memory you are allocated is computed as the
number of CPU cores you requested multiplied by 1/22 of the total memory
available (as there are 22 CPU cores per node). So, if you request a
full standard node (22 cores), then you will be allocated a maximum of
all of the memory (128 GB) available on the node; however, if you
request 1 core, then you will be assigned a maximum of 128/22 = 2.9 GB
of the memory available on the node.e.</p>
</div>
</div>
</div>
<p>Then submit your job.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  sbatch serial-pi.sh</span></code></pre>
</div>
<p>As before, use the status commands to check when your job runs. Use
<code>ls</code> to locate the output file, and examine it. Is it what
you expected?</p>
<ul>
<li>How good is the value for π?</li>
<li>How much memory did it need?</li>
<li>How long did the job take to run?</li>
</ul>
<p>Modify the job script to increase both the number of samples (perhaps
by a factor of 2, then by a factor of 10), and resubmit the job each
time.</p>
<ul>
<li>How good is the value for π?</li>
<li>How much memory did it need?</li>
<li>Did you encounter any errors?</li>
</ul>
<p>Even with sufficient memory for necessary variables, a script could
require enormous amounts of time to calculate on a single CPU. To reduce
the amount of time required, we need to modify the script to use
multiple CPUs for the calculations. In the largest problem scales, we
could use multiple CPUs in multiple compute nodes, distributing the
memory requirements across all the nodes used to calculate the
solution.</p>
</section><section><h2 class="section-heading" id="running-the-parallel-job">Running the Parallel Job<a class="anchor" aria-label="anchor" href="#running-the-parallel-job"></a>
</h2>
<hr class="half-width">
<p>We will run an example that uses the Message Passing Interface (MPI)
for parallelism – this is a common tool on HPC systems.</p>
<div id="what-is-mpi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-is-mpi" class="callout-inner">
<h3 class="callout-title">What is MPI?</h3>
<div class="callout-content">
<p>The Message Passing Interface is a set of tools which allow multiple
parallel jobs to communicate with each other. Typically, a single
executable is run multiple times, possibly on different machines, and
the MPI tools are used to inform each instance of the executable about
how many instances there are, which instance it is. MPI also provides
tools to allow communication and coordination between instances. An MPI
instance typically has its own copy of all the local variables.</p>
</div>
</div>
</div>
<p>While MPI jobs can generally be run as stand-alone executables, in
order for them to run in parallel they must use an MPI <em>run-time
system</em>, which is a specific implementation of the MPI
<em>standard</em>. To do this, they should be started via a command such
as <code>mpiexec</code> (or <code>mpirun</code>, or <code>srun</code>,
etc. depending on the MPI run-time you need to use), which will ensure
that the appropriate run-time support for parallelism is included.</p>
<div id="mpi-runtime-arguments" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="mpi-runtime-arguments" class="callout-inner">
<h3 class="callout-title">MPI Runtime Arguments</h3>
<div class="callout-content">
<p>On their own, commands such as <code>mpiexec</code> can take many
arguments specifying how many machines will participate in the
execution, and you might need these if you would like to run an MPI
program on your laptop (for example). In the context of a queuing
system, however, it is frequently the case that we do not need to
specify this information as the MPI run-time will have been configured
to obtain it from the queuing system, by examining the environment
variables set when the job is launched.</p>
</div>
</div>
</div>
<div id="what-changes-are-needed-for-an-mpi-version-of-the-π-calculator" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="what-changes-are-needed-for-an-mpi-version-of-the-π-calculator" class="callout-inner">
<h3 class="callout-title">What Changes Are Needed for an MPI Version of the π Calculator?</h3>
<div class="callout-content">
<p>First, we need to import the <code>MPI</code> object from the Python
module <code>mpi4py</code> by adding an
<code>from mpi4py import MPI</code> line immediately below the
<code>import datetime</code> line.</p>
<p>Second, we need to modify the “main” function to perform the overhead
and accounting work required to:</p>
<ul>
<li>subdivide the total number of points to be sampled,</li>
<li>
<em>partition</em> the total workload among the various parallel
processors available,</li>
<li>have each parallel process report the results of its workload back
to the “rank 0” process, which does the final calculations and prints
out the result.</li>
</ul>
<p>The modifications to the serial script demonstrate four important
concepts:</p>
<ul>
<li>COMM_WORLD: the default MPI Communicator, providing a channel for
all the processes involved in this <code>mpiexec</code> to exchange
information with one another.</li>
<li>Scatter: A collective operation in which an array of data on one MPI
rank is divided up, with separate portions being sent out to the partner
ranks. Each partner rank receives data from the matching index of the
host array.</li>
<li>Gather: The inverse of scatter. One rank populates a local array,
with the array element at each index assigned the value provided by the
corresponding partner rank – including the host’s own value.</li>
<li>Conditional Output: since every rank is running the <em>same
code</em>, the partitioning, the final calculations, and the
<code>print</code> statement are wrapped in a conditional so that only
one rank performs these operations.</li>
</ul>
</div>
</div>
</div>
<p>We add the lines:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>comm <span class="op">=</span> MPI.COMM_WORLD</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>cpus <span class="op">=</span> comm.Get_size()</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>rank <span class="op">=</span> comm.Get_rank()</span></code></pre>
</div>
<p>immediately before the <code>n_samples</code> line to set up the MPI
environment for each process.</p>
<p>We replace the <code>start_time</code> and <code>counts</code> lines
with the lines:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="cf">if</span> rank <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  start_time <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  partitions <span class="op">=</span> [ <span class="bu">int</span>(n_samples <span class="op">/</span> cpus) ] <span class="op">*</span> cpus</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  counts <span class="op">=</span> [ <span class="bu">int</span>(<span class="dv">0</span>) ] <span class="op">*</span> cpus</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  partitions <span class="op">=</span> <span class="va">None</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  counts <span class="op">=</span> <span class="va">None</span></span></code></pre>
</div>
<p>This ensures that only the rank 0 process measures times and
coordinates the work to be distributed to all the ranks, while the other
ranks get placeholder values for the <code>partitions</code> and
<code>counts</code> variables.</p>
<p>Immediately below these lines, let’s</p>
<ul>
<li>distribute the work among the ranks with MPI
<code>scatter</code>,</li>
<li>call the <code>inside_circle</code> function so each rank can
perform its share of the work,</li>
<li>collect each rank’s results into a <code>counts</code> variable on
rank 0 using MPI <code>gather</code>.</li>
</ul>
<p>by adding the following three lines:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>partition_item <span class="op">=</span> comm.scatter(partitions, root<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>count_item <span class="op">=</span> inside_circle(partition_item)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>counts <span class="op">=</span> comm.gather(count_item, root<span class="op">=</span><span class="dv">0</span>)</span></code></pre>
</div>
<p>Illustrations of these steps are shown below.</p>
<div class="section level3">
<h3 id="the-parallel-message-passing-interface-mpi-process">The Parallel Message Passing Interface (MPI) Process<a class="anchor" aria-label="anchor" href="#the-parallel-message-passing-interface-mpi-process"></a>
</h3>
<p>Step 1: Setup the MPI environment and initialize local variables –
including the vector containing the number of points to generate on each
parallel processor:</p>
<figure><img src="../fig/initialize.png" alt="MPI initialize" class="figure mx-auto d-block"><div class="figcaption">Step1: Initialise the MPI environment</div>
</figure><p>Step 2: Distribute the number of points from the originating vector
to all the parallel processors:</p>
<figure><img src="../fig/scatter.png" alt="MPI scatter" class="figure mx-auto d-block"><div class="figcaption">Step 2: Distribute tasks</div>
</figure><p>Step 3: Perform the computation in parallel:</p>
<figure><img src="../fig/compute.png" alt="MPI compute" class="figure mx-auto d-block"><div class="figcaption">Step 3: Parallel computation</div>
</figure><p>Step 4: Retrieve counts from all the parallel processes:</p>
<figure><img src="../fig/gather.png" alt="MPI gather" class="figure mx-auto d-block"><div class="figcaption">Step 4: Gather the resulting counts</div>
</figure><p>Step 5: Print out the report:</p>
<figure><img src="../fig/finalize.png" alt="MPI finalize" class="figure mx-auto d-block"><div class="figcaption">Step 5: Finalise the result</div>
</figure><hr>
<p>Finally, we’ll ensure the <code>my_pi</code> through
<code>print</code> lines only run on rank 0. Otherwise, every parallel
processor will print its local value, and the report will become
hopelessly garbled:</p>
<pre><code>if rank == 0:
   my_pi = 4.0 * sum(counts) / sum(partitions)
   end_time = datetime.datetime.now()
   elapsed_time = (end_time - start_time).total_seconds()
   size_of_float = np.dtype(np.float64).itemsize
   memory_required = 3 * sum(partitions) * size_of_float / (1024**3)
   pi_specific = np.pi
   accuracy = 100*(1-my_pi/pi_specific)
   print(f"Pi: {my_pi:6f}, memory: {memory_required:6f} GiB, time: {elapsed_time:6f} s, error: {accuracy:6f}%")</code></pre>
<p>A fully commented version of the final MPI parallel python code is
available: <a href="https://nclrse-training.github.io/hpc-intro-cirrus/files/pi-mpi-cirrus.py" class="external-link">pi-mpi-cirrus.py</a>.</p>
<p>Our purpose here is to exercise the parallel workflow of the cluster,
not to optimize the program to minimize its memory footprint. Rather
than push our local machines to the breaking point (or, worse, the login
node), let’s give it to a cluster node with more resources.</p>
<p>Create a submission file, requesting more than one task on a single
node:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  nano parallel-pi.sh</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  cat parallel-pi.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --partition=short
#SBATCH --job-name parallel-pi
#SBATCH --nodes=1
#SBATCH --tasks-per-node=4
#SBATCH --time=00:01

# Load the correct Python module
module load python/3.9.13

# Execute the task
srun python pi-mpi-cirrus.py 100000000</code></pre>
</div>
<p>Then submit your job.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[userid@login01</span> ~]$  sbatch parallel-pi.sh</span></code></pre>
</div>
<p>As before, use the status commands to check when your job runs. Use
<code>ls</code> to locate the output file, and examine it. Is it what
you expected?</p>
<ul>
<li>How good is the value for π?</li>
<li>How much memory did it need?</li>
<li>How much faster was this run than the serial run with 100000000
points?</li>
</ul>
<p>Modify the job script to increase the number of samples (perhaps by a
factor of 2, then by a factor of 10), and resubmit the job each time.
You can also increase the number of CPUs.</p>
<ul>
<li>How good is the value for π?</li>
<li>How much memory did it need?</li>
<li>How long did the job take to run?</li>
</ul>
</div>
</section><section><h2 class="section-heading" id="how-much-does-mpi-improve-performance">How Much Does MPI Improve Performance?<a class="anchor" aria-label="anchor" href="#how-much-does-mpi-improve-performance"></a>
</h2>
<hr class="half-width">
<p>In theory, by dividing up the π calculations among <em>n</em> MPI
processes, we should see run times reduce by a factor of <em>n</em>. In
practice, some time is required to start the additional MPI processes,
for the MPI processes to communicate and coordinate, and some types of
calculations may only be able to run effectively on a single CPU.</p>
<p>Additionally, if the MPI processes operate on different physical CPUs
in the computer, or across multiple compute nodes, additional time is
required for communication compared to all processes operating on a
single CPU.</p>
<p><a href="https://en.wikipedia.org/wiki/Amdahl's_law" class="external-link">Amdahl’s
Law</a> is one way of predicting improvements in execution time for a
<strong>fixed</strong> parallel workload. If a workload needs 20 hours
to complete on a single core, and one hour of that time is spent on
tasks that cannot be parallelized, only the remaining 19 hours could be
parallelized. Even if an infinite number of cores were used for the
parallel parts of the workload, the total run time cannot be less than
one hour.</p>
<p>In practice, it’s common to evaluate the parallelism of an MPI
program by</p>
<ul>
<li>running the program across a range of CPU counts,</li>
<li>recording the execution time on each run,</li>
<li>comparing each execution time to the time when using a single
CPU.</li>
</ul>
<p>The speedup factor <em>S</em> is calculated as the single-CPU
execution time divided by the multi-CPU execution time. For a laptop
with 8 cores, the graph of speedup factor versus number of cores used
shows relatively consistent improvement when using 2, 4, or 8 cores, but
using additional cores shows a diminishing return.</p>
<div class="section level3">
<h3 id="laptop-performance">Laptop performance<a class="anchor" aria-label="anchor" href="#laptop-performance"></a>
</h3>
<figure><img src="../fig/laptop-mpi_Speedup_factor.png" alt="MPI speedup factors on an 8-core laptop" class="figure mx-auto d-block"><div class="figcaption">MPI speedup factors on an 8-core laptop</div>
</figure><p>For a set of HPC nodes containing 28 cores each, the graph of speedup
factor versus number of cores shows consistent improvements up through
three nodes and 84 cores, but <strong>worse</strong> performance when
adding a fourth node with an additional 28 cores. This is due to the
amount of communication and coordination required among the MPI
processes requiring more time than is gained by reducing the amount of
work each MPI process has to complete. This communication overhead is
not included in Amdahl’s Law.</p>
</div>
<div class="section level3">
<h3 id="hpc-performance">HPC performance<a class="anchor" aria-label="anchor" href="#hpc-performance"></a>
</h3>
<figure><img src="../fig/hpc-mpi_Speedup_factor.png" alt="MPI speedup factors on HPC" class="figure mx-auto d-block"><div class="figcaption">MPI speedup factors on HPC</div>
</figure><p>In practice, MPI speedup factors are influenced by:</p>
<ul>
<li>CPU design,</li>
<li>the communication network between compute nodes,</li>
<li>the MPI library implementations, and</li>
<li>the details of the MPI program itself.</li>
</ul>
<p>In an HPC environment, we try to reduce the execution time for all
types of jobs, and MPI is an extremely common way to combine dozens,
hundreds, or thousands of CPUs into solving a single problem. To learn
more about parallelization, see the <a href="http://www.hpc-carpentry.org/hpc-parallel-novice/" class="external-link">parallel novice
lesson</a> lesson.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“Parallel programming allows applications to take advantage of
parallel hardware; serial code will not ‘just work.’”</li>
<li>“Distributed memory parallelism is a common case, using the Message
Passing Interface (MPI).”</li>
<li>“The queuing system facilitates executing parallel tasks.”</li>
<li>“Performance improvements from parallel execution do not scale
linearly.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-70-resources"><p>Content from <a href="70-resources.html">Using resources effectively</a></p>
<hr>
<p>Last updated on 2025-02-14 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/70-resources.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 40 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we monitor our jobs?</li>
<li>How can I get my jobs scheduled more easily?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how to look up job statistics and profile code.</li>
<li>Understand job size implications.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We’ve touched on all the skills you need to interact with an HPC
cluster: logging in over SSH, loading software modules, submitting
parallel jobs, and finding the output. Let’s learn about estimating
resource usage and why it might matter. To do this we need to understand
the basics of <em>benchmarking</em>. Benchmarking is essentially
performing simple experiments to help understand how the performance of
our work varies as we change the properties of the jobs on the cluster -
including input parameters, job options and resources used.</p>
<div id="our-example" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="our-example" class="callout-inner">
<h3 class="callout-title">Our example</h3>
<div class="callout-content">
<p>In the rest of this episode, we will use an example parallel
application that calculates an estimate of the value of Pi. Although
this is a toy problem, it exhibits all the properties of a full parallel
application that we are interested in for this course.</p>
<p>The main resource we will consider here is the use of compute core
time as this is the resource you are usually charged for on HPC
resources. However, other resources - such as memory use - may also have
a bearing on how you choose resources and constrain your choice.</p>
<p>For those that have come across HPC benchmarking before, you may be
aware that people often make a distinction between <em>strong
scaling</em> and <em>weak scaling</em>:</p>
<ul>
<li>Strong scaling is where the problem size (i.e. the
<em>application</em>) stays the same size and we try to use more cores
to solve the problem faster.</li>
<li>Weak scaling is where the problem size increases at the same rate as
we increase the core count so we are using more cores to solve a larger
problem.</li>
</ul>
<p>Both of these approaches are equally valid uses of HPC. This example
looks at strong scaling.</p>
</div>
</div>
</div>
<p>Before we work on benchmarking, it is useful to define some terms for
the example we will be using</p>
<ul>
<li>
<strong>Program</strong> The computer program we are executing
(<code>pi-mpi.py</code> in the examples below)</li>
<li>
<strong>Application</strong> The combination of computer program
with particular input parameters</li>
</ul>
<section><h2 class="section-heading" id="accessing-the-software-and-input">Accessing the software and input<a class="anchor" aria-label="anchor" href="#accessing-the-software-and-input"></a>
</h2>
<hr class="half-width">
<div id="required-files" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="required-files" class="callout-inner">
<h3 class="callout-title">Required Files</h3>
<div class="callout-content">
<p>The program used in this example can be retrieved using wget or a
browser and copied to the remote.</p>
<p><strong>Using wget</strong>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[username3@login02</span> ]$ wget http://training.researchcomputing.ncl.ac.uk/training-materials/pi-mpi.py</span></code></pre>
</div>
<p><strong>Using a web browser</strong>:</p>
<p><a href="http://training.researchcomputing.ncl.ac.uk/training-materials/pi-mpi.py" class="external-link">http://training.researchcomputing.ncl.ac.uk/training-materials/pi-mpi.py</a></p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="baseline-running-in-serial">Baseline: running in serial<a class="anchor" aria-label="anchor" href="#baseline-running-in-serial"></a>
</h2>
<hr class="half-width">
<p>Before starting to benchmark an application to understand what
resources are best to use, you need a <em>baseline</em> performance
result. In more formal benchmarking, your baseline is usually the
minimum number of cores or nodes you can run on. However, for
understanding how best to use resources, as we are doing here, your
baseline could be the performance on any number of cores or nodes that
you can measure the change in performance from.</p>
<p>Our <code>pi-mpi.py</code> application is small enough that we can
run a serial (i.e. using a single core) job for our baseline performance
so that is where we will start</p>
<div id="run-a-single-core-job" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="run-a-single-core-job" class="callout-inner">
<h3 class="callout-title">Run a single core job</h3>
<div class="callout-content">
<p>Write a job submission script that runs the <code>pi-mpi.py</code>
application on a single core. You will need to take an initial guess as
to the walltime to request to give the job time to complete. Submit the
job and check the contents of the STDOUT file to see if the application
worked or not.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Creating a file called <code>submit-pi-mpi.slurm</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#SBATCH --partition=short</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#SBATCH --job-name=pi-mpi</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#SBATCH --tasks-per-node=1</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#SBATCH --time=00:15:00</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="ex">srun</span> python pi-mpi.py 10000000</span></code></pre>
</div>
<p>Run application using a single process (i.e. in serial) with a
blocking <code>srun</code> command:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">module</span> load cray-python</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun <span class="at">--partition</span><span class="op">=</span>short python pi-mpi.py 10000000</span></code></pre>
</div>
<p>Submit with to the batch queue with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun submit-pi-mpi.slurm</span></code></pre>
</div>
<p>Output in the job log should look something like:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Generating 10000000 samples.
Rank 0 generating 10000000 samples on host nid001246.
Numpy Pi:  3.141592653589793
My Estimate of Pi:  3.1416708
1 core(s), 10000000 samples, 228.881836 MiB memory, 0.423903 seconds, -0.002487% error</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Once your job has run, you should look in the output to identify the
performance. Most HPC programs should print out timing or performance
information (usually somewhere near the bottom of the summary output)
and <code>pi-mpi.py</code> is no exception. You should see two lines in
the output that look something like:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">256</span> core<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="ex">,</span> 100000000 samples, 2288.818359 MiB memory, 0.135041 seconds, <span class="at">-0.004774%</span> error</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">Total</span> run time=0.18654435999997077s</span></code></pre>
</div>
<p>You can also get an estimate of the overall run time from the final
job statistics. If we look at how long the finished job ran for, this
will provide a quick way to see roughly what the runtime was. This can
be useful if you want to know quickly if a job was faster or not than a
previous job (as you do not have to find the output file to look up the
performance) but the number is not as accurate as the performance
recorded by the application itself and also includes static overheads
from running the job (such as loading modules and startup time) that can
skew the timings. To do this on use <code>sacct -l -j 12345</code> with
the job ID, e.g.:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sacct <span class="at">-l</span> <span class="at">-j</span> 12345</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID USER         ACCOUNT     NAME           ST REASON START_TIME         T...
36856 yourUsername yourAccount example-job.sh R  None   2017-07-01T16:47:02 ...</code></pre>
</div>
</section><section><h2 class="section-heading" id="running-in-parallel-and-benchmarking-performance">Running in parallel and benchmarking performance<a class="anchor" aria-label="anchor" href="#running-in-parallel-and-benchmarking-performance"></a>
</h2>
<hr class="half-width">
<p>We have now managed to run the <code>pi-mpi.py</code> application
using a single core and have a baseline performance we can use to judge
how well we are using resources on the system.</p>
<p>Note that we also now have a good estimate of how long the
application takes to run so we can provide a better setting for the
walltime for future jobs we submit. Lets now look at how the runtime
varies with core count.</p>
<div id="benchmarking-the-parallel-performance" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="benchmarking-the-parallel-performance" class="callout-inner">
<h3 class="callout-title">Benchmarking the parallel performance</h3>
<div class="callout-content">
<p>Modify your job script to run on multiple cores and evaluate the
performance of <code>pi-mpi.py</code> on a variety of different core
counts and use multiple runs to complete a table like the one below. If
you examine the log file you will see that it contains two timings: the
total time taken by the entire program and the time taken solely by the
calculation. The calculation of Pi from the Monte-Carlo counts is not
parallelised so this is a serial overhead, performed by a single
processor. The calculation part is, in theory, perfectly parallel (each
processor operates on independent sets of unique random numbers ) so
this should get faster on more cores. The Calculation core seconds is
the <em>calculation time</em> multiplied by the number of cores.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="26%">
<col width="26%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Cores</th>
<th>Overall run time (s)</th>
<th>Calculation time (s)</th>
<th>Calculation core seconds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1 (serial)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>4</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>8</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>16</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>32</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>64</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>128</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>256</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Look at your results – do they make sense? Given the structure of the
code, you would expect the performance of the calculation to increase
linearly with the number of cores: this would give a roughly constant
figure for the Calculation core seconds. Is this what you observe?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The table below shows example timings for runs on ARCHER2 (HPC at
Edinburgh)</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="25%">
<col width="25%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="right">Cores</th>
<th align="right">Overall run time (s)</th>
<th align="right">Calculation time (s)</th>
<th align="right">Calculation core seconds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">3.931</td>
<td align="right">3.854</td>
<td align="right">3.854</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2.002</td>
<td align="right">1.930</td>
<td align="right">3.859</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1.048</td>
<td align="right">0.972</td>
<td align="right">3.888</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.572</td>
<td align="right">0.495</td>
<td align="right">3.958</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">0.613</td>
<td align="right">0.536</td>
<td align="right">8.574</td>
</tr>
<tr class="even">
<td align="right">32</td>
<td align="right">0.360</td>
<td align="right">0.278</td>
<td align="right">8.880</td>
</tr>
<tr class="odd">
<td align="right">64</td>
<td align="right">0.249</td>
<td align="right">0.163</td>
<td align="right">10.400</td>
</tr>
<tr class="even">
<td align="right">128</td>
<td align="right">0.170</td>
<td align="right">0.083</td>
<td align="right">10.624</td>
</tr>
<tr class="odd">
<td align="right">256</td>
<td align="right">0.187</td>
<td align="right">0.135</td>
<td align="right">34.560</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="understanding-the-performance">Understanding the performance<a class="anchor" aria-label="anchor" href="#understanding-the-performance"></a>
</h2>
<hr class="half-width">
<p>Now we have some data showing the performance of our application we
need to try and draw some useful conclusions as to what the most
efficient set of resources are to use for our jobs. To do this we
introduce two metrics:</p>
<ul>
<li>
<strong>Actual speedup</strong> The ratio of the baseline runtime
(or runtime on the lowest core count) to the runtime at the specified
core count. i.e. baseline runtime divided by runtime at the specified
core count.</li>
<li>
<strong>Ideal speedup</strong> The expected speedup if the
application showed perfect scaling. i.e. if you double the number of
cores, the application should run twice as fast.</li>
<li>
<strong>Parallel efficiency</strong> The fraction of <em>ideal
speedup</em> actually obtained for a given core count. This gives an
indication of how well you are exploiting the additional resources you
are using.</li>
</ul>
<p>We will now use our performance results to compute these two metrics
for the sharpen application and use the metrics to evaluate the
performance and make some decisions about the most effective use of
resources.</p>
<div id="computing-the-speedup-and-parallel-efficiency" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="computing-the-speedup-and-parallel-efficiency" class="callout-inner">
<h3 class="callout-title">Computing the speedup and parallel efficiency</h3>
<div class="callout-content">
<p>Use your <em>Overall run times</em> from above to fill in a table
like the one below.</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="25%">
<col width="19%">
<col width="18%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th>Cores</th>
<th>Overall run time (s)</th>
<th>Actual speedup</th>
<th>Ideal speedup</th>
<th>Parallel efficiency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1 (serial)</td>
<td><span class="math inline">\(t_{c1}\)</span></td>
<td>-</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\(t_{c2}\)</span></td>
<td><span class="math inline">\(s_2 = t_{c1}/t_{c2}\)</span></td>
<td><span class="math inline">\(i_2 = 2\)</span></td>
<td><span class="math inline">\(s_2 / i_2\)</span></td>
</tr>
<tr class="odd">
<td>4</td>
<td><span class="math inline">\(t_{c4}\)</span></td>
<td><span class="math inline">\(s_4 = t_{c1}/t_{c4}\)</span></td>
<td><span class="math inline">\(i_4 = 4\)</span></td>
<td><span class="math inline">\(s_4 / i_4\)</span></td>
</tr>
<tr class="even">
<td>8</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>16</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>32</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>64</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>128</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>256</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Given your results, try to answer the following questions:</p>
<ol style="list-style-type: decimal">
<li>What is the core count where you get the <strong>most</strong>
efficient use of resources, irrespective of run time?</li>
<li>What is the core count where you get the fastest solution,
irrespective of efficiency?</li>
<li>What do you think a good core count choice would be for this
application that balances time to solution and efficiency? Why did you
choose this option?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The table below gives example results for ARCHER2 (HPC at Edinburgh)
based on the example runtimes given in the solution above.</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="25%">
<col width="18%">
<col width="17%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="right">Cores</th>
<th align="right">Overall run time (s)</th>
<th align="right">Actual speedup</th>
<th align="right">Ideal speedup</th>
<th align="right">Parallel efficiency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">3.931</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2.002</td>
<td align="right">1.963</td>
<td align="right">2.000</td>
<td align="right">0.982</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1.048</td>
<td align="right">3.751</td>
<td align="right">4.000</td>
<td align="right">0.938</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.572</td>
<td align="right">6.872</td>
<td align="right">8.000</td>
<td align="right">0.859</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">0.613</td>
<td align="right">6.408</td>
<td align="right">16.000</td>
<td align="right">0.401</td>
</tr>
<tr class="even">
<td align="right">32</td>
<td align="right">0.360</td>
<td align="right">10.928</td>
<td align="right">32.000</td>
<td align="right">0.342</td>
</tr>
<tr class="odd">
<td align="right">64</td>
<td align="right">0.249</td>
<td align="right">15.767</td>
<td align="right">64.000</td>
<td align="right">0.246</td>
</tr>
<tr class="even">
<td align="right">128</td>
<td align="right">0.170</td>
<td align="right">23.122</td>
<td align="right">128.000</td>
<td align="right">0.181</td>
</tr>
<tr class="odd">
<td align="right">256</td>
<td align="right">0.187</td>
<td align="right">21.077</td>
<td align="right">256.000</td>
<td align="right">0.082</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="what-is-the-core-count-where-you-get-the-most-efficient-use-of-resources">What is the core count where you get the <strong>most</strong>
efficient use of resources?<a class="anchor" aria-label="anchor" href="#what-is-the-core-count-where-you-get-the-most-efficient-use-of-resources"></a>
</h3>
<p>Just using a single core is the cheapest (and always will be unless
your speedup is better than perfect – “super-linear” speedup). However,
it may not be possible to run on small numbers of cores depending on how
much memory you need or other technical constraints.
<strong>Note:</strong> on most high-end systems, nodes are not shared
between users. This means you are charged for all the CPU-cores on a
node regardless of whether you actually use them. Typically we would be
running on many hundreds of CPU-cores not a few tens, so the real
question in practice is: what is the optimal number of nodes to use? ###
What is the core count where you get the fastest solution, irrespective
of efficiency? 256 cores gives the fastest time to solution. The fastest
time to solution does not often make the most efficient use of resources
so to use this option, you may end up wasting your resources. Sometimes,
when there is time pressure to run the calculations, this may be a valid
approach to running applications. ### What do you think a good core
count choice would be for this application to use?</p>
<p>8 cores is probably a good number of cores to use with a parallel
efficiency of 86%. Usually, the best choice is one that delivers good
parallel efficiency with an acceptable time to solution. Note that
<em>acceptable time to solution</em> differs depending on circumstances
so this is something that the individual researcher will have to assess.
Good parallel efficiency is often considered to be 70% or greater though
many researchers will be happy to run in a regime with parallel
efficiency greater than 60%. As noted above, running with worse parallel
efficiency may also be useful if the time to solution is an overriding
factor.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="tips">Tips<a class="anchor" aria-label="anchor" href="#tips"></a>
</h2>
<hr class="half-width">
<p>Here are a few tips to help you use resources effectively and
efficiently on HPC systems:</p>
<ul>
<li>Know what your priority is: do you want the results as fast as
possible or are you happy to wait longer but get more research for the
resources you have been allocated?</li>
<li>Use your real research application to benchmark but try to shorten
the run so you can turn around your benchmarking runs in a short
timescale. Ideally, it should run for 10-30 minutes; short enough to run
quickly but long enough so the performance is not dominated by static
startup overheads (though this is application dependent). Ways to do
this potentially include, for example: using a smaller number of time
steps, restricting the number of SCF cycles, restricting the number of
optimisation steps.</li>
<li>Use basic benchmarking to help define the best resource use for your
application. One useful strategy: take the core count you are using as
the baseline, halve the number of cores/nodes and rerun and then double
the number of cores/nodes from your baseline and rerun. Use the three
data points to assess your efficiency and the impact of different
core/node counts.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“The smaller your job, the faster it will schedule.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-80-responsibility"><p>Content from <a href="80-responsibility.html">Using shared resources responsibly</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/80-responsibility.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I be a responsible user?</li>
<li>How can I protect my data?</li>
<li>How can I best get large amounts of data off an HPC system?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe how the actions of a single user can affect the experience
of others on a shared system.</li>
<li>Learn how to be a considerate shared system citizen.</li>
<li>Explain the importance of backing up critical data.</li>
<li>Describe the challenges with transferring large amounts of data off
HPC systems.</li>
<li>Understand how to convert many files to a single archive file using
tar.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>One of the major differences between using remote HPC resources and
your own system (e.g. your laptop) is that remote resources are shared.
How many users the resource is shared between at any one time varies
from system to system but it is unlikely you will ever be the only user
logged into or using such a system.</p>
<p>The widespread usage of scheduling systems where users submit jobs on
HPC resources is a natural outcome of the shared nature of these
resources. There are other things you, as an upstanding member of the
community, need to consider.</p>
<section><h2 class="section-heading" id="be-kind-to-the-login-nodes">Be Kind to the Login Nodes<a class="anchor" aria-label="anchor" href="#be-kind-to-the-login-nodes"></a>
</h2>
<hr class="half-width">
<p>The login node is often busy managing all of the logged in users,
creating and editing files and compiling software. If the machine runs
out of memory or processing capacity, it will become very slow and
unusable for everyone. While the machine is meant to be used, be sure to
do so responsibly — in ways that will not adversely impact other users’
experience.</p>
<p>Login nodes are always the right place to launch jobs. Cluster
policies vary, but they may also be used for proving out workflows, and
in some cases, may host advanced cluster-specific debugging or
development tools. The cluster may have modules that need to be loaded,
possibly in a certain order, and paths or library versions that differ
from your laptop, and doing an interactive test run on the head node is
a quick and reliable way to discover and fix these issues.</p>
<div id="login-nodes-are-a-shared-resource" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="login-nodes-are-a-shared-resource" class="callout-inner">
<h3 class="callout-title">Login Nodes Are a Shared Resource</h3>
<div class="callout-content">
<p>Remember, the login node is shared with all other users and your
actions could cause issues for other people. Think carefully about the
potential implications of issuing commands that may use large amounts of
resource.</p>
<p>Unsure? Ask your friendly systems administrator (“sysadmin”) or
service desk if the thing you’re contemplating is suitable for the login
node, or if there’s another mechanism to get it done safely.</p>
<p>You can contact the rse team at <a href="mailto:rseteam@newcastle.ac.uk" class="email">rseteam@newcastle.ac.uk</a> and the it service desk at
nuservice.ncl.ac.uk or email <a href="mailto:it.servicedesk@newcastle.ac.uk" class="email">it.servicedesk@newcastle.ac.uk</a></p>
</div>
</div>
</div>
<p>You can always use the commands <code>top</code> and
<code>ps ux</code> to list the processes that are running on the login
node along with the amount of CPU and memory they are using. If this
check reveals that the login node is somewhat idle, you can safely use
it for your non-routine processing task. If something goes wrong — the
process takes too long, or doesn’t respond — you can use the
<code>kill</code> command along with the <em>PID</em> to terminate the
process.</p>
<div id="login-node-etiquette" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="login-node-etiquette" class="callout-inner">
<h3 class="callout-title">Login Node Etiquette</h3>
<div class="callout-content">
<p>Which of these commands would be a routine task to run on the login
node?</p>
<ol style="list-style-type: decimal">
<li><code>python physics_sim.py</code></li>
<li><code>make</code></li>
<li><code>create_directories.sh</code></li>
<li><code>molecular_dynamics_2</code></li>
<li><code>tar -xzf R-3.3.0.tar.gz</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Building software, creating directories, and unpacking software are
common and acceptable tasks for the login node: options #2
(<code>make</code>), #3 (<code>mkdir</code>), and #5 (<code>tar</code>)
are probably OK. Note that script names do not always reflect their
contents: before launching #3, please
<code>less create_directories.sh</code> and make sure it’s not a Trojan
horse. Running resource-intensive applications is frowned upon. Unless
you are sure it will not affect other users, do not run jobs like #1
(<code>python</code>) or #4 (custom MD code). If you’re unsure, ask your
friendly sysadmin for advice.</p>
</div>
</div>
</div>
</div>
<p>If you experience performance issues with a login node you should
report it to the system staff (usually via the helpdesk) for them to
investigate.</p>
</section><section><h2 class="section-heading" id="test-before-scaling">Test Before Scaling<a class="anchor" aria-label="anchor" href="#test-before-scaling"></a>
</h2>
<hr class="half-width">
<p>Remember that you are generally charged for usage on shared systems.
A simple mistake in a job script can end up costing a large amount of
resource budget. Imagine a job script with a mistake that makes it sit
doing nothing for 24 hours on 1000 cores or one where you have requested
2000 cores by mistake and only use 100 of them! This problem can be
compounded when people write scripts that automate job submission (for
example, when running the same calculation or analysis over lots of
different parameters or files). When this happens it hurts both you (as
you waste lots of charged resource) and other users (who are blocked
from accessing the idle compute nodes).</p>
<p>On very busy resources you may wait many days in a queue for your job
to fail within 10 seconds of starting due to a trivial typo in the job
script. This is extremely frustrating!</p>
<p>Most systems provide dedicated resources for testing that have short
wait times to help you avoid this issue.</p>
<div id="test-job-submission-scripts-that-use-large-amounts-of-resources" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="test-job-submission-scripts-that-use-large-amounts-of-resources" class="callout-inner">
<h3 class="callout-title">Test Job Submission Scripts That Use Large Amounts of Resources</h3>
<div class="callout-content">
<p>Before submitting a large run of jobs, submit one as a test first to
make sure everything works as expected.</p>
<p>Before submitting a very large or very long job submit a short
truncated test to ensure that the job starts as expected.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="have-a-backup-plan">Have a Backup Plan<a class="anchor" aria-label="anchor" href="#have-a-backup-plan"></a>
</h2>
<hr class="half-width">
<p>Although many HPC systems keep backups, it does not always cover all
the file systems available and may only be for disaster recovery
purposes (<em>i.e.</em> for restoring the whole file system if lost
rather than an individual file or directory you have deleted by
mistake). Protecting critical data from corruption or deletion is
primarily your responsibility: keep your own backup copies.</p>
<p>Version control systems (such as Git) often have free, cloud-based
offerings (e.g., GitHub and GitLab) that are generally used for storing
source code. Even if you are not writing your own programs, these can be
very useful for storing job scripts, analysis scripts and small input
files.</p>
<p>For larger amounts of data, you should make sure you have a robust
system in place for taking copies of critical data off the HPC system
wherever possible to backed-up storage. Tools such as <code>rsync</code>
can be very useful for this.</p>
<p>Newcastle University provides campus file storage with roll-back
capability, mounted on Rocket under . Every project can register for 5TB
for free, additional space is charged per TB per year.</p>
<p>Your access to the shared HPC system will generally be time-limited
so you should ensure you have a plan for transferring your data off the
system before your access finishes. The time required to transfer large
amounts of data should not be underestimated and you should ensure you
have planned for this early enough (ideally, before you even start using
the system for your research).</p>
<p>In all these cases, the service desk of the system you are using
should be able to provide useful guidance on your options for data
transfer for the volumes of data you will be using.</p>
<div id="your-data-is-your-responsibility" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="your-data-is-your-responsibility" class="callout-inner">
<h3 class="callout-title">Your Data Is Your Responsibility</h3>
<div class="callout-content">
<p>Make sure you understand what the backup policy is on the file
systems on the system you are using and what implications this has for
your work if you lose your data on the system. Plan your backups of
critical data and how you will transfer data off the system throughout
the project.</p>
<p>On ARCHER2, the home file systems are backed up so you can restore
data you deleted by mistake. A copy of the data on home file system is
also kept off site for disaster recovery purposes. The work file systems
are not backed up in any way.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="transferring-data">Transferring Data<a class="anchor" aria-label="anchor" href="#transferring-data"></a>
</h2>
<hr class="half-width">
<p>As mentioned above, many users run into the challenge of transferring
large amounts of data off HPC systems at some point (this is more often
in transferring data off than onto systems but the advice below applies
in either case). Data transfer speed may be limited by many different
factors so the best data transfer mechanism to use depends on the type
of data being transferred and where the data is going.</p>
<p>The components between your data’s source and destination have
varying levels of performance, and in particular, may have different
capabilities with respect to <strong>bandwidth</strong> and
<strong>latency</strong>.</p>
<p><strong>Bandwidth</strong> is generally the raw amount of data per
unit time a device is capable of transmitting or receiving. It’s a
common and generally well-understood metric.</p>
<p><strong>Latency</strong> is a bit more subtle. For data transfers, it
may be thought of as the amount of time it takes to get data out of
storage and into a transmittable form. Latency issues are the reason
it’s advisable to execute data transfers by moving a small number of
large files, rather than the converse.</p>
<p>Some of the key components and their associated issues are:</p>
<ul>
<li>
<strong>Disk speed</strong>: File systems on HPC systems are often
highly parallel, consisting of a very large number of high performance
disk drives. This allows them to support a very high data bandwidth.
Unless the remote system has a similar parallel file system you may find
your transfer speed limited by disk performance at that end.</li>
<li>
<strong>Meta-data performance</strong>: <em>Meta-data
operations</em> such as opening and closing files or listing the owner
or size of a file are much less parallel than read/write operations. If
your data consists of a very large number of small files you may find
your transfer speed is limited by meta-data operations. Meta-data
operations performed by other users of the system can also interact
strongly with those you perform so reducing the number of such
operations you use (by combining multiple files into a single file) may
reduce variability in your transfer rates and increase transfer
speeds.</li>
<li>
<strong>Network speed</strong>: Data transfer performance can be
limited by network speed. More importantly it is limited by the slowest
section of the network between source and destination. If you are
transferring to your laptop/workstation, this is likely to be its
connection (either via LAN or WiFi).</li>
<li>
<strong>Firewall speed</strong>: Most modern networks are protected
by some form of firewall that filters out malicious traffic. This
filtering has some overhead and can result in a reduction in data
transfer performance. The needs of a general purpose network that hosts
email/web-servers and desktop machines are quite different from a
research network that needs to support high volume data transfers. If
you are trying to transfer data to or from a host on a general purpose
network you may find the firewall for that network will limit the
transfer rate you can achieve.</li>
</ul>
<p>As mentioned above, if you have related data that consists of a large
number of small files it is strongly recommended to pack the files into
a larger <em>archive</em> file for long term storage and transfer. A
single large file makes more efficient use of the file system and is
easier to move, copy and transfer because significantly fewer metadata
operations are required. Archive files can be created using tools like
<code>tar</code> and <code>zip</code>. We have already met
<code>tar</code> when we talked about data transfer earlier.</p>
<div id="consider-the-best-way-to-transfer-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="consider-the-best-way-to-transfer-data" class="callout-inner">
<h3 class="callout-title">Consider the Best Way to Transfer Data</h3>
<div class="callout-content">
<p>If you are transferring large amounts of data you will need to think
about what may affect your transfer performance. It is always useful to
run some tests that you can use to extrapolate how long it will take to
transfer your data. Say you have a “data” folder containing 10,000 or so
files, a healthy mix of small and large ASCII and binary data. Which of
the following would be the best way to transfer them to Rocket?</p>
<ol style="list-style-type: decimal">
<li>Using <code>scp</code>?</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ scp <span class="at">-r</span> data userid@rocket.hpc:~/</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>rsync</code>?</li>
</ol>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ rsync <span class="at">-ra</span> data userid@rocket.hpc:~/</span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Using <code>rsync</code> with compression?</li>
</ol>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ rsync <span class="at">-raz</span> data userid@rocket.hpc:~/</span></code></pre>
</div>
<p>3.a. Using <code>rsync</code> with compression to transfer to a
mounted filesystem?</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[[userid@login01</span> ~]$ rsync <span class="at">-raz</span> <span class="at">--inplace</span> data /rdw/02/myproject/</span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Creating a <code>tar</code> archive first for
<code>rsync</code>?</li>
</ol>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ tar <span class="at">-cvf</span> data.tar data</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ rsync <span class="at">-raz</span> data.tar userid@rocket.hpc:~/</span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Creating a compressed <code>tar</code> archive for
<code>rsync</code>?</li>
</ol>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ tar <span class="at">-cvzf</span> data.tar.gz data</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">[user@laptop</span> ~]$ rsync <span class="at">-ra</span> data.tar.gz userid@rocket.hpc:~/</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Lets go through each option</p>
<ol style="list-style-type: decimal">
<li>
<code>scp</code> will recursively copy the directory. This works,
but without compression.</li>
<li>
<code>rsync -ra</code> works like <code>scp -r</code>, but preserves
file information like creation times. This is marginally better.</li>
<li>
<code>rsync -raz</code> adds compression, which will save some
bandwidth. If you have a strong CPU at both ends of the line, and you’re
on a slow network, this is a good choice.<br>
3.a) <strong>However</strong> on a fast network (for example
transferring from Rocket to RDW, both within the data centre) it is
faster to transfer without compression. <code>--inplace</code> tells
rsync not to create a temporary file prior to sending but send the data
straight away. The temporary file helps rsync resume when the connection
is interrupted but at the cost of disk space and time to write this
file.</li>
<li>This command first uses <code>tar</code> to merge everything into a
single file, then <code>rsync -z</code> to transfer it with compression.
With this large <em>number</em> of files, metadata overhead can hamper
your transfer, so this is a good idea.</li>
<li>This command uses <code>tar -z</code> to compress the archive, then
<code>rsync</code> to transfer it. This may perform similarly to #4, but
in most cases (for large datasets), it’s the best combination of high
throughput and low latency (making the most of your time and network
connection). <strong>However</strong> on a fast network (for example
transferring from Rocket to RDW, both within the data centre) it is
faster to transfer without compression.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="rsync-tips" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="rsync-tips" class="callout-inner">
<h3 class="callout-title">Rsync Tips</h3>
<div class="callout-content">
<p><code>--dry-run</code> will show you what files would be changed,
without copying any data. Useful if you’re not sure you have the correct
path, or you are adding to / over-writing existing data.</p>
<p>Immediately re-running the same rsync command is a good way to check
that the first run completed fully. No files will be copied if the first
run was successful.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“Be careful how you use the login node.”</li>
<li>“Your data on the system is your responsibility.”</li>
<li>“Plan and test large data transfers.”</li>
<li>“It is often best to convert many files to a single archive file
before transferring.”</li>
<li>“Again, don’t run stuff on the login node.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/" class="external-link">Source</a></p>
				<p><a href="https://github.com/NclRSE-Training/hpc-intro-rocket/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:workshoporganisation@group.newcastle.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://NclRSE-Training.github.io/hpc-intro-rocket/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://NclRSE-Training.github.io/hpc-intro-rocket/instructor/aio.html",
  "identifier": "https://NclRSE-Training.github.io/hpc-intro-rocket/instructor/aio.html",
  "dateCreated": "2025-02-12",
  "dateModified": "2025-03-07",
  "datePublished": "2025-03-07"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

