<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to HPC: Working with the scheduler</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/30-scheduler.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to HPC
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to HPC
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to HPC
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 15%" class="percentage">
    15%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 15%" aria-valuenow="15" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/30-scheduler.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="10-hpc-intro.html">1. Why use an HPC System?</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="20-cluster.html">2. Working on an HPC system</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Working with the scheduler
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#job-scheduler">Job Scheduler</a></li>
<li><a href="#running-a-batch-job">Running a Batch Job</a></li>
<li><a href="#submit-a-job-to-the-scheduler">Submit a job to the scheduler</a></li>
<li><a href="#customising-a-job">Customising a Job</a></li>
<li><a href="#cancelling-a-job">Cancelling a Job</a></li>
<li><a href="#other-types-of-jobs">Other Types of Jobs</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="40-modules.html">4. Accessing software via Modules</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="50-transferring-files.html">5. Transferring files with remote computers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="60-parallel-job.html">6. Running a parallel job</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="70-resources.html">7. Using resources effectively</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="80-responsibility.html">8. Using shared resources responsibly</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="20-cluster.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="40-modules.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="20-cluster.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Working on an HPC
        </a>
        <a class="chapter-link float-end" href="40-modules.html" rel="next">
          Next: Accessing software...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Working with the scheduler</h1>
        <p>Last updated on 2025-03-11 |

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/30-scheduler.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is a scheduler and why are they used?</li>
<li>How do I launch a program to run on any one node in the
cluster?</li>
<li>How do I capture the output of a program that is run on a node in
the cluster?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Run a simple Hello World style program on the cluster.</li>
<li>Submit a simple Hello World style script to the cluster.</li>
<li>Use the batch system command line tools to monitor the execution of
your job.</li>
<li>Inspect the output and error files of your jobs.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="job-scheduler">Job Scheduler<a class="anchor" aria-label="anchor" href="#job-scheduler"></a></h2>
<hr class="half-width"><p>An HPC system might have thousands of nodes and thousands of users.
How do we decide who gets what and when? How do we ensure that a task is
run with the resources it needs? This job is handled by a special piece
of software called the scheduler. On an HPC system, the scheduler
manages which jobs run where and when.</p>
<p>The following illustration compares these tasks of a job scheduler to
a waiter in a restaurant. If you can relate to an instance where you had
to wait for a while in a queue to get in to a popular restaurant, then
you may now understand why sometimes your job do not start instantly as
in your laptop.</p>
<figure><img src="fig/restaurant_queue_manager.svg" caption="" alt="Compare a job scheduler to a waiter in a restaurant" class="figure mx-auto d-block"><div class="figcaption">The waiter scheduler</div>
</figure><p>The scheduler used in this lesson is Slurm. Although Slurm is not
used everywhere, running jobs is quite similar regardless of what
software is being used. The exact syntax might change, but the concepts
remain the same.</p>
</section><section><h2 class="section-heading" id="running-a-batch-job">Running a Batch Job<a class="anchor" aria-label="anchor" href="#running-a-batch-job"></a></h2>
<hr class="half-width"><p>The most basic use of the scheduler is to run a command
non-interactively. Any command (or series of commands) that you want to
run on the cluster is called a <em>job</em>, and the process of using a
scheduler to run the job is called <em>batch job submission</em>.</p>
<div id="work-in-the-project-directory" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="work-in-the-project-directory" class="callout-inner">
<h3 class="callout-title">work in the project directory</h3>
<div class="callout-content">
<p>First, let’s get in the habit of working in the project directory.
This makes it easier to ensure our collaborators can see the codes and
results we produce.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> cd to your directory under your project </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /nobackup/proj/training/userid/</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="substitute-your-username-for-userid" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="substitute-your-username-for-userid" class="callout-inner">
<h3 class="callout-title">Substitute your username for
<code>userid</code>
</h3>
<div class="callout-content">
<p>In all our examples, you will see <code>userid</code> in the place of
your own username.</p>
</div>
</div>
</div>
<p>In this case, the job we want to run is a shell script – essentially
a text file containing a list of UNIX commands to be executed in a
sequential manner. Our shell script will have three parts:</p>
<ul><li>On the very first line, add <code>#!/bin/bash</code>. The
<code>#!</code> (pronounced “hash-bang” or “shebang”) tells the computer
what program is meant to process the contents of this file. In this
case, we are telling it that the commands that follow are written for
the command-line shell (what we’ve been doing everything in so
far).</li>
<li>Anywhere below the first line, we’ll add an <code>echo</code>
command with a friendly greeting. When run, the shell script will print
whatever comes after <code>echo</code> in the terminal.
<ul><li>
<code>echo -n</code> will print everything that follows,
<em>without</em> ending the line by printing the new-line
character.</li>
</ul></li>
<li>On the last line, we’ll invoke the <code>hostname</code> command,
which will print the name of the machine the script is run on.</li>
<li>After our script is saved, we must make it executable, or linux
system security will not allow it to run. Use <code>chmod +x</code> to
do this.</li>
</ul><div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  nano example-job.sh</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  chmod +x example-job.sh</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash

echo -n "This script is running on "
hostname</code></pre>
</div>
<div id="creating-our-test-job" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-our-test-job" class="callout-inner">
<h3 class="callout-title">Creating Our Test Job</h3>
<div class="callout-content">
<p>Run the script. Does it execute on the cluster or just our login
node?</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  ./example-job.sh</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on login01</code></pre>
</div>
<p>This job runs on the login node. <strong>!! Remember !!</strong> we
don’t run jobs on the login node unless they are very small test jobs
like this one.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="submit-a-job-to-the-scheduler">Submit a job to the scheduler<a class="anchor" aria-label="anchor" href="#submit-a-job-to-the-scheduler"></a></h2>
<hr class="half-width"><p>If you completed the previous challenge successfully, you probably
realise that there is a distinction between running the job through the
scheduler and just “running it”. To submit this job to the scheduler, we
use the <code>sbatch</code> with the option
<code>--partition=short</code>.</p>
<div id="partitions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="partitions" class="callout-inner">
<h3 class="callout-title">Partitions</h3>
<div class="callout-content">
<p>The eagle eyed will have noticed a PARTITION column in the output of
<code>sinfo</code> in the previous episode. HPC systems divide resources
into partitions (or queues), for efficient scheduling.<br>
The ‘short’ partition only allows very short jobs (default 1 minute time
limit), which the scheduler can easily fit in the gaps between longer
jobs. Using ‘short’ is best for small test jobs as they don’t have to
wait in the queue behind bigger jobs.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Partitions on Rocket </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<pre><code>Partition (queue)	Nodes		Max concurrent 	Time limit (wallclock)	Default time limit (wallclock)	Default memory per core
defq			standard	528 cores	2 days			2 days				2.5 GB
bigmem			medium,large,XL	2 nodes		2 days(*)		2 days				11 GB
short			all		2 nodes		10 minutes		1 minute			2.5 GB
long			standard	2 nodes		30 days			5 days				2.5 GB
power(**)		power		1 node		2 days			2 days				2.5 GB
interactive		all		1 node		1 day or 2 hours idle time 2 hours			2.5 GB</code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch <span class="at">--partition</span><span class="op">=</span>short example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 36855</code></pre>
</div>
<p>Our work is done — now the scheduler takes over and tries to run the
job for us. While the job is waiting to run, it goes into a list of jobs
called the <em>queue</em>. To check on our job’s status, we check the
queue using the command <code>squeue -u userid</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div id="did-it-work" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="did-it-work" class="callout-inner">
<h3 class="callout-title">Did it work?</h3>
<div class="callout-content">
<p>If you get an error, check that you have substituted your own
username for <code>userid</code> in the command above</p>
</div>
</div>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER   ST    TIME  NODES NODELIST(REASON)
36855 short         example- userid PD    0:00  1     (None)</code></pre>
</div>
<p>We can see all the details of our job, most importantly that it is in
the <code>R</code> or <code>RUNNING</code> state.</p>
<p>Sometimes our jobs might need to wait in a queue (<code>PD</code> or
<code>PENDING</code>) or become terminated, for example due to
<code>OUT_OF_MEMORY</code> (<code>OOM</code>) error,
<code>TIMEOUT</code> (<code>TO</code>) or some other <code>FAILED</code>
(<code>F</code>) condition.</p>
<p>Other states you may see are: <code>CA</code> (cancelled),
<code>CF</code>(configuring), <code>CG</code> (completing),
<code>CD</code> (completed), <code>NF</code> (node failure),
<code>RV</code> (revoked) and <code>SE</code> (special exit state).</p>
<div id="wheres-the-output" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="wheres-the-output" class="callout-inner">
<h3 class="callout-title">Where’s the Output?</h3>
<div class="callout-content">
<p>On the login node, this script printed output to the terminal — but
when we exit <code>watch</code>, there’s nothing. Where’d it go? HPC job
output is typically redirected to a file in the directory you launched
it from. Use <code>ls</code> to find and <code>cat</code> to read the
file.</p>
<p>On some HPC systems you may need to redirect the output explictly in
your job submission script. You can achieve this by setting the options
for error <code>--error=&lt;error_filename&gt;</code> and output
<code>--output=&lt;output_filename&gt;</code> filenames. On Rocket this
is handled by default with output and error files named according to the
job submission id.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="customising-a-job">Customising a Job<a class="anchor" aria-label="anchor" href="#customising-a-job"></a></h2>
<hr class="half-width"><p>The job we just ran used some of the scheduler’s default options. In
a real-world scenario, that’s probably not what we want. The default
options represent a reasonable minimum. Chances are, we will need more
cores, more memory, more time, among other special considerations. To
get access to these resources we must customize our job script.</p>
<p>Comments in UNIX shell scripts (denoted by <code>#</code>) are
typically ignored, but there are exceptions. For instance the special
<code>#!</code> comment at the beginning of scripts specifies what
program should be used to run it (you’ll typically see
<code>#!/bin/bash</code>). Schedulers like Slurm also have a special
comment used to denote special scheduler-specific options. Though these
comments differ from scheduler to scheduler, Slurm’s special comment is
<code>#SBATCH</code>. Anything following the <code>#SBATCH</code>
comment is interpreted as an instruction to the scheduler.</p>
<p>Let’s illustrate this by example. By default, a job’s name is the
name of the script, but the <code>--job-name</code> option can be used
to change the name of a job. Add an option to the script:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --job-name new_name

echo -n "This script is running on "
hostname
echo "This script has finished successfully."</code></pre>
</div>
<p>Submit the job and monitor its status:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch <span class="at">--partition</span><span class="op">=</span>short example-job.sh</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID USER         ACCOUNT     NAME     ST REASON   START_TIME TIME TIME_LEFT NODES CPUS
38191 userid yourAccount new_name PD Priority N/A        0:00 1:00:00   1     1</code></pre>
</div>
<p>Fantastic, we’ve successfully changed the name of our job!</p>
<div class="section level3">
<h3 id="resource-requests">Resource Requests<a class="anchor" aria-label="anchor" href="#resource-requests"></a></h3>
<p>But what about more important changes, such as the number of cores
and memory for our jobs? One thing that is absolutely critical when
working on an HPC system is specifying the resources required to run a
job. This allows the scheduler to find the right time and place to
schedule our job. If you do not specify requirements (such as the amount
of time you need), you will likely be stuck with your site’s default
resources, which is probably not what you want.</p>
<p>The following are several key resource requests:</p>
<p><code>--account=&lt;project&gt;</code> your account is typically your
project code, for example <code>training</code>. Rocket does not charge
users but other HPCs use the <code>--account</code> option for charging
to a project budget.</p>
<p><code>--partition=&lt;partition&gt;</code> The partition specifies
the set of nodes you want to run on. More information on available
partitions is given in the <a href="https://www.ncl.ac.uk/itservice/research/hpc" class="external-link">Rocket
documentation</a>.</p>
<p>Other common options that are used are:</p>
<p><code>--time=&lt;hh:mm:ss&gt;</code> the maximum walltime for your
job. e.g. For a 6.5 hour walltime, you would use
<code>--time=06:30:00</code>.</p>
<p><code>--job-name=&lt;jobname&gt;</code> set a name for the job to
help identify it in Slurm command output.</p>
<p>In addition, parallel jobs will also need to specify how many nodes,
parallel processes and threads they require.</p>
<p><code>--exclusive</code> to ensure that you have exclusive access to
a compute node</p>
<p><code>--nodes=&lt;number&gt;</code> the number of nodes to use for
the job.</p>
<p><code>--tasks-per-node=&lt;processes per node&gt;</code> the number
of parallel processes (e.g. MPI ranks) per node.</p>
<p><code>--cpus-per-task=&lt;threads per task&gt;</code> the number of
threads per parallel process (e.g. number of OpenMP threads per MPI task
for hybrid MPI/OpenMP jobs). Note: you must also set the
<code>OMP_NUM_THREADS</code> environment variable if using OpenMP in
your job and usually add the <code>--cpu-bind=cores</code> option to
<code>srun</code></p>
<p>Note that just <em>requesting</em> these resources does not make your
job run faster, nor does it necessarily mean that you will consume all
of these resources. It only means that these are made available to you.
Your job may end up using less memory, or less time, or fewer tasks or
nodes, than you have requested, and it will still run.</p>
<p>It’s best if your requests accurately reflect your job’s
requirements. We’ll talk more about how to make sure that you’re using
resources effectively in a later episode of this lesson.</p>
<div id="command-line-options-or-job-script-options" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="command-line-options-or-job-script-options" class="callout-inner">
<h3 class="callout-title">Command line options or job script options?</h3>
<div class="callout-content">
<p>All of the options we specify can be supplied on the command line (as
we do here for <code>--partition=short</code>) or in the job script (as
we have done for the job name above). These are interchangeable. It is
often more convenient to put the options in the job script as it avoids
lots of typing at the command line.</p>
</div>
</div>
</div>
<div id="submitting-resource-requests" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="submitting-resource-requests" class="callout-inner">
<h3 class="callout-title">Submitting Resource Requests</h3>
<div class="callout-content">
<p>Modify our <code>hostname</code> script so that it runs for a minute,
then submit a job for it on the cluster. You should also move all the
options we have been specifying on the command line
(e.g. <code>--partition</code>) into the script at this point.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --time 00:01:15
#SBATCH --partition=short
echo -n "This script is running on "
sleep 60 # time in seconds
hostname
echo "This script has finished successfully."</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch example-job.sh</span></code></pre>
</div>
<p>Why are the Slurm runtime and <code>sleep</code> time not
identical?</p>
</div>
</div>
</div>
</div>
<div id="job-environment-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="job-environment-variables" class="callout-inner">
<h3 class="callout-title">Job environment variables</h3>
<div class="callout-content">
<p>When Slurm runs a job, it sets a number of environment variables for
the job. One of these will let us check what directory our job script
was submitted from. The <code>SLURM_SUBMIT_DIR</code> variable is set to
the directory from which our job was submitted.</p>
<p>Using the <code>SLURM_SUBMIT_DIR</code> variable, modify your job so
that it prints out the location from which the job was submitted.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  nano example-job.sh</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --partition=short
#SBATCH --time=00:01 # timeout in HH:MM

echo -n "This script is running on "
hostname

echo "This job was launched in the following directory:"
echo ${SLURM_SUBMIT_DIR}</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Resource requests are typically binding. If you exceed them, your job
will be killed. Let’s use walltime as an example. We will request 30
seconds of walltime, and attempt to run a job for two minutes.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH --job-name long_job
#SBATCH --time 00:00:30
#SBATCH --partition=short

echo "This script is running on ... "
sleep 120 # time in seconds
hostname
echo "This script has finished successfully."</code></pre>
</div>
<p>Submit the job and wait for it to finish. Once it is has finished,
check the log file.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch example-job.sh</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  cat slurm-17866475.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on ...
slurmstepd: error: *** JOB 17866475 ON sb013 CANCELLED AT 2025-02-19T07:00:57 DUE TO TIME LIMIT ***</code></pre>
</div>
<p>Our job was killed for exceeding the amount of resources it
requested. Although this appears harsh, this is actually a feature.
Strict adherence to resource requests allows the scheduler to find the
best possible place for your jobs. Even more importantly, it ensures
that another user cannot use more resources than they’ve been given. If
another user messes up and accidentally attempts to use all of the cores
or memory on a node, Slurm will either restrain their job to the
requested resources or kill the job outright. Other jobs on the node
will be unaffected. This means that one user cannot mess up the
experience of others, the only jobs affected by a mistake in scheduling
will be their own.</p>
<div id="but-how-much-does-it-cost" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="but-how-much-does-it-cost" class="callout-inner">
<h3 class="callout-title">But how much does it cost?</h3>
<div class="callout-content">
<p>Rocket does not currently charge you to run jobs but other HPCs do
charge. Although your job will be killed if it exceeds the selected
runtime, a job that completes within the time limit is only charged for
the time it actually used. However, you should always try and specify a
wallclock limit that is close to (but greater than!) the expected
runtime as this will enable your job to be scheduled more quickly. If
you say your job will run for an hour, the scheduler has to wait until a
full hour becomes free on the machine. If it only ever runs for 5
minutes, you could have set a limit of 10 minutes and it might have been
run earlier in the gaps between other users’ jobs.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="cancelling-a-job">Cancelling a Job<a class="anchor" aria-label="anchor" href="#cancelling-a-job"></a></h2>
<hr class="half-width"><p>Sometimes we’ll make a mistake and need to cancel a job. This can be
done with the <code>scancel</code> command. Let’s submit a job and then
cancel it using its job number (remember to change the walltime so that
it runs long enough for you to cancel it before it is killed!).</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  sbatch example-job.sh</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 38759

JOBID PARTITION     NAME     USER      ST    TIME  NODES NODELIST(REASON)
38759  short        long_job   ncb176  R     1:13      1 sb013</code></pre>
</div>
<p>Now cancel the job with its job number (printed in your terminal).
Absence of any job info indicates that the job has been successfully
cancelled.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  scancel 38759</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co"># It might take a minute for the job to disappear from the queue...</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  squeue <span class="at">-u</span> userid</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</code></pre>
</div>
<div id="cancelling-multiple-jobs" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="cancelling-multiple-jobs" class="callout-inner">
<h3 class="callout-title">Cancelling multiple jobs</h3>
<div class="callout-content">
<p>We can also cancel all of our jobs at once using the <code>-u</code>
option. This will delete all jobs for a specific user (in this case us).
Note that you can only delete your own jobs. Try submitting multiple
jobs and then cancelling them all with
<code>scancel -u userid</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-types-of-jobs">Other Types of Jobs<a class="anchor" aria-label="anchor" href="#other-types-of-jobs"></a></h2>
<hr class="half-width"><p>Up to this point, we’ve focused on running jobs in batch mode. Slurm
also provides the ability to start an interactive session.</p>
<p>There are very frequently tasks that need to be done interactively.
Creating an entire job script might be overkill, but the amount of
resources required is too much for a login node to handle. A good
example of this might be building a genome index for alignment with a
tool like <a href="https://ccb.jhu.edu/software/hisat2/index.shtml" class="external-link">HISAT2</a>.
Fortunately, we can run these types of tasks as a one-off with
<code>srun</code>.</p>
<p><code>srun</code> runs a single command in the queue system and then
exits. Let’s demonstrate this by running the <code>hostname</code>
command with <code>srun</code>. (We can cancel an <code>srun</code> job
with <code>Ctrl-c</code>.)</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun <span class="at">--partition</span><span class="op">=</span>short <span class="at">--time</span><span class="op">=</span>00:01:00 hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 17866477 queued and waiting for resources
srun: job 17866477 has been allocated resources
sb013.cluster</code></pre>
</div>
<p><code>srun</code> accepts all of the same options as
<code>sbatch</code>. However, instead of specifying these in a script,
these options are specified on the command-line when starting a job.</p>
<p>Typically, the resulting shell environment will be the same as that
for <code>sbatch</code>.</p>
<div class="section level3">
<h3 id="interactive-jobs">Interactive jobs<a class="anchor" aria-label="anchor" href="#interactive-jobs"></a></h3>
<p>Sometimes, you will need a lot of resource for interactive use.
Perhaps it’s our first time running an analysis or we are attempting to
debug something that went wrong with a previous job. Fortunately, SLURM
makes it easy to start an interactive job with <code>srun</code>:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">[userid@login01</span> userid]$  srun <span class="at">--partition</span><span class="op">=</span>interactive <span class="at">--pty</span> /bin/bash</span></code></pre>
</div>
<p>You should be presented with a bash prompt. Note that the prompt may
change to reflect your new location, in this case the compute node we
are logged on. You can also verify this with <code>hostname</code>.</p>
<p>When you are done with the interactive job, type <code>exit</code> to
quit your session.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>“The scheduler handles how compute resources are shared between
users.”</li>
<li>“Everything you do should be run through the scheduler.”</li>
<li>“A job is just a shell script.”</li>
<li>“If in doubt, request more resources than you will need.”</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="20-cluster.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="40-modules.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="20-cluster.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Working on an HPC
        </a>
        <a class="chapter-link float-end" href="40-modules.html" rel="next">
          Next: Accessing software...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/edit/main/episodes/30-scheduler.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/NclRSE-Training/hpc-intro-rocket/" class="external-link">Source</a></p>
				<p><a href="https://github.com/NclRSE-Training/hpc-intro-rocket/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:workshoporganisation@group.newcastle.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://NclRSE-Training.github.io/hpc-intro-rocket/30-scheduler.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Working with the scheduler",
  "creativeWorkStatus": "active",
  "url": "https://NclRSE-Training.github.io/hpc-intro-rocket/30-scheduler.html",
  "identifier": "https://NclRSE-Training.github.io/hpc-intro-rocket/30-scheduler.html",
  "dateCreated": "2025-02-12",
  "dateModified": "2025-03-11",
  "datePublished": "2025-03-11"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

